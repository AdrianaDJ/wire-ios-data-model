<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<title>ZMConversation.m - Slather</title>
<link href="slather.css" media="all" rel="stylesheet">
</head>
<body>
<header><div class="row"><a href="index.html"><img src="logo.jpg" alt="Slather logo"></a></div></header><div class="row"><div id="reports">
<h2 class="cov_title">
<span>Coverage for "ZMConversation.m" : </span><span class="cov_high">89.99%</span>
</h2>
<h4 class="cov_subtitle">(1331 of 1479 relevant lines covered)</h4>
<h4 class="cov_filepath">../Home/workspace/Utility jobs/Create a new version of framework/Source/Model/Conversation/ZMConversation.m</h4>
<table class="source_code">
<tr class="never">
<td class="num">1</td>
<td class="src"><pre><code class="objc">//</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2</td>
<td class="src"><pre><code class="objc">// Wire</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">3</td>
<td class="src"><pre><code class="objc">// Copyright (C) 2016 Wire Swiss GmbH</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">4</td>
<td class="src"><pre><code class="objc">//</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">5</td>
<td class="src"><pre><code class="objc">// This program is free software: you can redistribute it and/or modify</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">6</td>
<td class="src"><pre><code class="objc">// it under the terms of the GNU General Public License as published by</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">7</td>
<td class="src"><pre><code class="objc">// the Free Software Foundation, either version 3 of the License, or</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">8</td>
<td class="src"><pre><code class="objc">// (at your option) any later version.</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">9</td>
<td class="src"><pre><code class="objc">//</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">10</td>
<td class="src"><pre><code class="objc">// This program is distributed in the hope that it will be useful,</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">11</td>
<td class="src"><pre><code class="objc">// but WITHOUT ANY WARRANTY; without even the implied warranty of</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">12</td>
<td class="src"><pre><code class="objc">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">13</td>
<td class="src"><pre><code class="objc">// GNU General Public License for more details.</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">14</td>
<td class="src"><pre><code class="objc">//</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">15</td>
<td class="src"><pre><code class="objc">// You should have received a copy of the GNU General Public License</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">16</td>
<td class="src"><pre><code class="objc">// along with this program. If not, see http://www.gnu.org/licenses/.</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">17</td>
<td class="src"><pre><code class="objc">//</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">18</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">19</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">20</td>
<td class="src"><pre><code class="objc">@import Foundation;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">21</td>
<td class="src"><pre><code class="objc">@import zimages;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">22</td>
<td class="src"><pre><code class="objc">@import ZMUtilities;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">23</td>
<td class="src"><pre><code class="objc">@import ZMTransport;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">24</td>
<td class="src"><pre><code class="objc">@import Cryptobox;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">25</td>
<td class="src"><pre><code class="objc">@import MobileCoreServices;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">26</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">27</td>
<td class="src"><pre><code class="objc">#import "ZMManagedObject+Internal.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">28</td>
<td class="src"><pre><code class="objc">#import "ZMManagedObjectContextProvider.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">29</td>
<td class="src"><pre><code class="objc">#import "ZMConversation+Internal.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">30</td>
<td class="src"><pre><code class="objc">#import "ZMConversation+Timestamps.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">31</td>
<td class="src"><pre><code class="objc">#import "ZMConversation+UnreadCount.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">32</td>
<td class="src"><pre><code class="objc">#import "ZMConversation+OTR.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">33</td>
<td class="src"><pre><code class="objc">#import "ZMVoiceChannel.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">34</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">35</td>
<td class="src"><pre><code class="objc">#import "ZMUser+Internal.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">36</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">37</td>
<td class="src"><pre><code class="objc">#import "ZMMessage+Internal.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">38</td>
<td class="src"><pre><code class="objc">#import "ZMClientMessage.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">39</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">40</td>
<td class="src"><pre><code class="objc">#import "NSManagedObjectContext+zmessaging.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">41</td>
<td class="src"><pre><code class="objc">#import "ZMConnection+Internal.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">42</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">43</td>
<td class="src"><pre><code class="objc">#import "ZMConversationList+Internal.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">44</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">45</td>
<td class="src"><pre><code class="objc">#import "ZMConversationListDirectory.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">46</td>
<td class="src"><pre><code class="objc">#import &lt;ZMCDataModel/ZMCDataModel-Swift.h&gt;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">47</td>
<td class="src"><pre><code class="objc">#import "NSPredicate+ZMSearch.h"</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">48</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">49</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationArchivedEventIDDataKey = @"archivedEventID_data";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">50</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationArchivedEventIDKey = @"archivedEventID";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">51</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationConnectionKey = @"connection";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">52</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationHasUnreadMissedCallKey = @"hasUnreadMissedCall";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">53</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationHasUnreadUnsentMessageKey = @"hasUnreadUnsentMessage";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">54</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationIsArchivedKey = @"internalIsArchived";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">55</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationIsSelfAnActiveMemberKey = @"isSelfAnActiveMember";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">56</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationIsSilencedKey = @"isSilenced";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">57</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationLastReadEventIDDataKey = @"lastReadEventID_data";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">58</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationMessagesKey = @"messages";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">59</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationHiddenMessagesKey = @"hiddenMessages";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">60</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationOtherActiveParticipantsKey = @"otherActiveParticipants";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">61</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationHasUnreadKnock = @"hasUnreadKnock";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">62</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationUnsyncedActiveParticipantsKey = @"unsyncedActiveParticipants";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">63</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationUnsyncedInactiveParticipantsKey = @"unsyncedInactiveParticipants";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">64</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationUserDefinedNameKey = @"userDefinedName";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">65</td>
<td class="src"><pre><code class="objc">NSString *const ZMVisibleWindowLowerKey = @"ZMVisibleWindowLowerKey";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">66</td>
<td class="src"><pre><code class="objc">NSString *const ZMVisibleWindowUpperKey = @"ZMVisibleWindowUpperKey";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">67</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationCallParticipantsKey = @"callParticipants";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">68</td>
<td class="src"><pre><code class="objc">NSString *const ZMIsDimmedKey = @"zmIsDimmed";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">69</td>
<td class="src"><pre><code class="objc">NSString *const ZMNormalizedUserDefinedNameKey = @"normalizedUserDefinedName";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">70</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationListIndicatorKey = @"conversationListIndicator";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">71</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationConversationTypeKey = @"conversationType";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">72</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationClearedEventIDDataKey = @"clearedEventID_data";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">73</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationClearedEventIDKey = @"clearedEventID";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">74</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationLastServerTimeStampKey = @"lastServerTimeStamp";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">75</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationLastReadServerTimeStampKey = @"lastReadServerTimeStamp";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">76</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationClearedTimeStampKey = @"clearedTimeStamp";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">77</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationArchivedChangedTimeStampKey = @"archivedChangedTimestamp";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">78</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationSilencedChangedTimeStampKey = @"silencedChangedTimestamp";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">79</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">80</td>
<td class="src"><pre><code class="objc">NSString *const ZMNotificationConversationKey = @"ZMNotificationConversationKey";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">81</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">82</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationCallDeviceIsActiveKey = @"callDeviceIsActive";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">83</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationIsSendingVideoKey = @"isSendingVideo";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">84</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationIsIgnoringCallKey = @"isIgnoringCall";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">85</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">86</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationWillStartFetchingMessages = @"ZMConversationWillStartFetchingMessages";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">87</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationDidFinishFetchingMessages = @"ZMConversationDidFinishFetchingMessages";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">88</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationDidChangeVisibleWindowNotification = @"ZMConversationDidChangeVisibileWindow";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">89</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationVoiceChannelJoinFailedNotification = @"ZMConversationVoiceChannelJoinFailedNotification";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">90</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationRequestToLoadConversationEventsNotification = @"ZMConversationRequestToLoadConversationEvents";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">91</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationEstimatedUnreadCountKey = @"estimatedUnreadCount";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">92</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationRemoteIdentifierDataKey = @"remoteIdentifier_data";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">93</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">94</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationClearTypingNotificationName = @"ZMConversationClearTypingNotification";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">95</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationIsVerifiedNotificationName = @"ZMConversationIsVerifiedNotificationName";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">96</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationFailedToDecryptMessageNotificationName = @"ZMConversationFailedToDecryptMessageNotificationName";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">97</td>
<td class="src"><pre><code class="objc">NSString *const ZMConversationLastReadDidChangeNotificationName = @"ZMConversationLastReadDidChangeNotification";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">98</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">99</td>
<td class="src"><pre><code class="objc">static NSString *const CallStateNeedsToBeUpdatedFromBackendKey = @"callStateNeedsToBeUpdatedFromBackend";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">100</td>
<td class="src"><pre><code class="objc">static NSString *const ConnectedUserKey = @"connectedUser";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">101</td>
<td class="src"><pre><code class="objc">static NSString *const ConversationTypeKey = @"conversationType";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">102</td>
<td class="src"><pre><code class="objc">static NSString *const CreatorKey = @"creator";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">103</td>
<td class="src"><pre><code class="objc">static NSString *const DownloadedMessageIDsDataKey = @"downloadedMessageIDs_data";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">104</td>
<td class="src"><pre><code class="objc">static NSString *const DownloadedMessageIDsKey = @"downloadedMessageIDs";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">105</td>
<td class="src"><pre><code class="objc">static NSString *const DraftMessageTextKey = @"draftMessageText";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">106</td>
<td class="src"><pre><code class="objc">static NSString *const IsPendingConnectionConversationKey = @"isPendingConnectionConversation";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">107</td>
<td class="src"><pre><code class="objc">static NSString *const LastModifiedDateKey = @"lastModifiedDate";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">108</td>
<td class="src"><pre><code class="objc">static NSString *const LastEventIDDataKey = @"lastEventID_data";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">109</td>
<td class="src"><pre><code class="objc">static NSString *const LastEventIDKey = @"lastEventID";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">110</td>
<td class="src"><pre><code class="objc">static NSString *const LastReadEventIDKey = @"lastReadEventID";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">111</td>
<td class="src"><pre><code class="objc">static NSString *const LastReadMessageKey = @"lastReadMessage";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">112</td>
<td class="src"><pre><code class="objc">static NSString *const LastServerSyncedActiveParticipantsKey = @"lastServerSyncedActiveParticipants";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">113</td>
<td class="src"><pre><code class="objc">static NSString *const NeedsToBeUpdatedFromBackendKey = @"needsToBeUpdatedFromBackend";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">114</td>
<td class="src"><pre><code class="objc">static NSString *const OtherInactiveParticipantsKey = @"otherInactiveParticipants";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">115</td>
<td class="src"><pre><code class="objc">static NSString *const RemoteIdentifierKey = @"remoteIdentifier";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">116</td>
<td class="src"><pre><code class="objc">static NSString *const VoiceChannelKey = @"voiceChannel";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">117</td>
<td class="src"><pre><code class="objc">static NSString *const VoiceChannelStateKey = @"voiceChannelState";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">118</td>
<td class="src"><pre><code class="objc">static NSString *const CallDeviceIsActiveKey = @"callDeviceIsActive";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">119</td>
<td class="src"><pre><code class="objc">static NSString *const IsFlowActiveKey = @"isFlowActive";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">120</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">121</td>
<td class="src"><pre><code class="objc">static NSString *const SecurityLevelKey = @"securityLevel";</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">122</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">123</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">124</td>
<td class="src"><pre><code class="objc">NSTimeInterval ZMConversationDefaultLastReadEventIDSaveDelay = 3.0;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">125</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">126</td>
<td class="src"><pre><code class="objc">const NSUInteger ZMConversationMaxEncodedTextMessageLength = 1500;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">127</td>
<td class="src"><pre><code class="objc">const NSUInteger ZMConversationMaxTextMessageLength = ZMConversationMaxEncodedTextMessageLength - 50; // Empirically we verified that the encoding adds 44 bytes</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">128</td>
<td class="src"><pre><code class="objc">const NSUInteger ZMLeadingEventIDWindowBleed = 50;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">129</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">130</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">131</td>
<td class="src"><pre><code class="objc">@interface ZMConversation ()</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">132</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">133</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSString *normalizedUserDefinedName;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">134</td>
<td class="src"><pre><code class="objc">@property (nonatomic) ZMConversationType conversationType;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">135</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">136</td>
<td class="src"><pre><code class="objc">@property (nonatomic) ZMEventID *tempMaximumLastReadEventID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">137</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSDate *tempMaxLastReadServerTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">138</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSMutableOrderedSet *unreadTimeStamps;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">139</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">140</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSTimeInterval lastReadEventIDSaveDelay;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">141</td>
<td class="src"><pre><code class="objc">@property (nonatomic) int64_t lastReadEventIDUpdateCounter;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">142</td>
<td class="src"><pre><code class="objc">@property (nonatomic) ZMEventID *archivedEventID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">143</td>
<td class="src"><pre><code class="objc">@property (nonatomic) BOOL internalIsArchived;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">144</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">145</td>
<td class="src"><pre><code class="objc">@property (nonatomic) ZMEventID *clearedEventID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">146</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSDate *lastReadServerTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">147</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSDate *lastServerTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">148</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSDate *clearedTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">149</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSDate *archivedChangedTimestamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">150</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSDate *silencedChangedTimestamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">151</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">152</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">153</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">154</td>
<td class="src"><pre><code class="objc">/// Declaration of properties implemented (automatically) by Core Data</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">155</td>
<td class="src"><pre><code class="objc">@interface ZMConversation (CoreDataForward)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">156</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">157</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSDate *primitiveLastReadServerTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">158</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSDate *primitiveLastServerTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">159</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSUUID *primitiveRemoteIdentifier;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">160</td>
<td class="src"><pre><code class="objc">@property (nonatomic) NSData *remoteIdentifier_data;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">161</td>
<td class="src"><pre><code class="objc">@property (nonatomic) ZMVoiceChannel *primitiveVoiceChannel;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">162</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">163</td>
<td class="src"><pre><code class="objc">@property (nonatomic) ZMConversationSecurityLevel securityLevel;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">164</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">165</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">166</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">167</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">168</td>
<td class="src"><pre><code class="objc">@implementation ZMConversation</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">169</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">170</td>
<td class="src"><pre><code class="objc">@dynamic userDefinedName;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">171</td>
<td class="src"><pre><code class="objc">@dynamic messages;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">172</td>
<td class="src"><pre><code class="objc">@dynamic lastModifiedDate;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">173</td>
<td class="src"><pre><code class="objc">@dynamic creator;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">174</td>
<td class="src"><pre><code class="objc">@dynamic draftMessageText;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">175</td>
<td class="src"><pre><code class="objc">@dynamic normalizedUserDefinedName;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">176</td>
<td class="src"><pre><code class="objc">@dynamic conversationType;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">177</td>
<td class="src"><pre><code class="objc">@dynamic archivedEventID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">178</td>
<td class="src"><pre><code class="objc">@dynamic clearedEventID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">179</td>
<td class="src"><pre><code class="objc">@dynamic clearedTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">180</td>
<td class="src"><pre><code class="objc">@dynamic lastReadServerTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">181</td>
<td class="src"><pre><code class="objc">@dynamic lastServerTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">182</td>
<td class="src"><pre><code class="objc">@dynamic isSilenced;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">183</td>
<td class="src"><pre><code class="objc">@dynamic isMuted;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">184</td>
<td class="src"><pre><code class="objc">@dynamic isTrusted;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">185</td>
<td class="src"><pre><code class="objc">@dynamic hasUntrustedClients;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">186</td>
<td class="src"><pre><code class="objc">@dynamic internalIsArchived;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">187</td>
<td class="src"><pre><code class="objc">@dynamic archivedChangedTimestamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">188</td>
<td class="src"><pre><code class="objc">@dynamic silencedChangedTimestamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">189</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">190</td>
<td class="src"><pre><code class="objc">@synthesize tempMaximumLastReadEventID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">191</td>
<td class="src"><pre><code class="objc">@synthesize tempMaxLastReadServerTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">192</td>
<td class="src"><pre><code class="objc">@synthesize lastReadEventIDSaveDelay;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">193</td>
<td class="src"><pre><code class="objc">@synthesize lastReadEventIDUpdateCounter;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">194</td>
<td class="src"><pre><code class="objc">@synthesize unreadTimeStamps;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">195</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">196</td>
<td class="src"><pre><code class="objc">- (BOOL)isArchived</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">197</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4180x</td>
</tr>
<tr class="covered">
<td class="num">198</td>
<td class="src"><pre><code class="objc">    return self.internalIsArchived;</code></pre></td>
<td class="coverage">4180x</td>
</tr>
<tr class="covered">
<td class="num">199</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4180x</td>
</tr>
<tr class="never">
<td class="num">200</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">201</td>
<td class="src"><pre><code class="objc">- (void)setIsArchived:(BOOL)isArchived</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">202</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">107x</td>
</tr>
<tr class="covered">
<td class="num">203</td>
<td class="src"><pre><code class="objc">    self.internalIsArchived = isArchived;</code></pre></td>
<td class="coverage">107x</td>
</tr>
<tr class="covered">
<td class="num">204</td>
<td class="src"><pre><code class="objc">    [self updateArchivedChangedTimeStampIfNeeded:self.lastServerTimeStamp andSync:YES];</code></pre></td>
<td class="coverage">107x</td>
</tr>
<tr class="covered">
<td class="num">205</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">107x</td>
</tr>
<tr class="never">
<td class="num">206</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">207</td>
<td class="src"><pre><code class="objc">- (NSUInteger)estimatedUnreadCount</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">208</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">8230x</td>
</tr>
<tr class="covered">
<td class="num">209</td>
<td class="src"><pre><code class="objc">    return (unsigned long)self.internalEstimatedUnreadCount;</code></pre></td>
<td class="coverage">8230x</td>
</tr>
<tr class="covered">
<td class="num">210</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">8230x</td>
</tr>
<tr class="never">
<td class="num">211</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">212</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingEstimatedUnreadCount</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">213</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">214</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObject: ZMConversationInternalEstimatedUnreadCountKey];</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">215</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="never">
<td class="num">216</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">217</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">218</td>
<td class="src"><pre><code class="objc">- (void)setIsSilenced:(BOOL)isSilenced</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">219</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">220</td>
<td class="src"><pre><code class="objc">    [self willChangeValueForKey:ZMConversationIsSilencedKey];</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">221</td>
<td class="src"><pre><code class="objc">    [self setPrimitiveValue:@(isSilenced) forKey:ZMConversationIsSilencedKey];</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">222</td>
<td class="src"><pre><code class="objc">    [self didChangeValueForKey:ZMConversationIsSilencedKey];</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">223</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">224</td>
<td class="src"><pre><code class="objc">    if (self.managedObjectContext.zm_isUserInterfaceContext) {</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="covered">
<td class="num">225</td>
<td class="src"><pre><code class="objc">        [self updateSilencedChangedTimeStampIfNeeded:self.lastServerTimeStamp andSync:YES];</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">226</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">227</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">31x</td>
</tr>
<tr class="never">
<td class="num">228</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">229</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingIsSilenced</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">230</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">231</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObject:ZMConversationIsSilencedKey];</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">232</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="never">
<td class="num">233</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">234</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForFilteringResults</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">235</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="covered">
<td class="num">236</td>
<td class="src"><pre><code class="objc">    static NSPredicate *predicate;</code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="covered">
<td class="num">237</td>
<td class="src"><pre><code class="objc">    static dispatch_once_t onceToken;</code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="covered">
<td class="num">238</td>
<td class="src"><pre><code class="objc">    dispatch_once(&amp;onceToken, ^{</code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="covered">
<td class="num">239</td>
<td class="src"><pre><code class="objc">        predicate = [NSPredicate predicateWithFormat:@"%K != %d &amp;&amp; %K != %d",</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">240</td>
<td class="src"><pre><code class="objc">                     ConversationTypeKey, ZMConversationTypeInvalid,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">241</td>
<td class="src"><pre><code class="objc">                     ConversationTypeKey, ZMConversationTypeSelf];</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">242</td>
<td class="src"><pre><code class="objc">    });</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">243</td>
<td class="src"><pre><code class="objc">    return predicate;</code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="covered">
<td class="num">244</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="never">
<td class="num">245</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">246</td>
<td class="src"><pre><code class="objc">+ (NSFetchRequest *)sortedFetchRequest</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">247</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">79x</td>
</tr>
<tr class="covered">
<td class="num">248</td>
<td class="src"><pre><code class="objc">    NSFetchRequest *request = [super sortedFetchRequest];</code></pre></td>
<td class="coverage">79x</td>
</tr>
<tr class="covered">
<td class="num">249</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">79x</td>
</tr>
<tr class="covered">
<td class="num">250</td>
<td class="src"><pre><code class="objc">    if(request.predicate) {</code></pre></td>
<td class="coverage">79x</td>
</tr>
<tr class="covered">
<td class="num">251</td>
<td class="src"><pre><code class="objc">        request.predicate = [NSCompoundPredicate andPredicateWithSubpredicates:@[request.predicate, self.predicateForFilteringResults]];</code></pre></td>
<td class="coverage">79x</td>
</tr>
<tr class="covered">
<td class="num">252</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">79x</td>
</tr>
<tr class="missed">
<td class="num">253</td>
<td class="src"><pre><code class="objc">    else {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">254</td>
<td class="src"><pre><code class="objc">        request.predicate = self.predicateForFilteringResults;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">255</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">256</td>
<td class="src"><pre><code class="objc">    return request;</code></pre></td>
<td class="coverage">79x</td>
</tr>
<tr class="covered">
<td class="num">257</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">79x</td>
</tr>
<tr class="never">
<td class="num">258</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">259</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForObjectsThatNeedToBeInsertedUpstream;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">260</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">261</td>
<td class="src"><pre><code class="objc">    NSPredicate *superPredicate = [super predicateForObjectsThatNeedToBeInsertedUpstream];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">262</td>
<td class="src"><pre><code class="objc">    NSPredicate *onlyGoupPredicate = [NSPredicate predicateWithFormat:@"%K == %@", ConversationTypeKey, @(ZMConversationTypeGroup)];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">263</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[superPredicate, onlyGoupPredicate]];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">264</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">265</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">266</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForObjectsThatNeedToBeUpdatedUpstream;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">267</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">268</td>
<td class="src"><pre><code class="objc">    NSPredicate *superPredicate = [super predicateForObjectsThatNeedToBeUpdatedUpstream];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">269</td>
<td class="src"><pre><code class="objc">    NSPredicate *onlyGoupPredicate = [NSPredicate predicateWithFormat:@"(%K != NULL) AND (%K != %@) AND (%K == 0)",</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">270</td>
<td class="src"><pre><code class="objc">                                      [self remoteIdentifierDataKey],</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">271</td>
<td class="src"><pre><code class="objc">                                      ConversationTypeKey, @(ZMConversationTypeInvalid),</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">272</td>
<td class="src"><pre><code class="objc">                                      NeedsToBeUpdatedFromBackendKey];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">273</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[superPredicate, onlyGoupPredicate]];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">274</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="never">
<td class="num">275</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">276</td>
<td class="src"><pre><code class="objc">- (void)awakeFromFetch;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">277</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">200x</td>
</tr>
<tr class="covered">
<td class="num">278</td>
<td class="src"><pre><code class="objc">    [super awakeFromFetch];</code></pre></td>
<td class="coverage">200x</td>
</tr>
<tr class="covered">
<td class="num">279</td>
<td class="src"><pre><code class="objc">    self.lastReadEventIDSaveDelay = ZMConversationDefaultLastReadEventIDSaveDelay;</code></pre></td>
<td class="coverage">200x</td>
</tr>
<tr class="covered">
<td class="num">280</td>
<td class="src"><pre><code class="objc">    if (self.managedObjectContext.zm_isSyncContext) {</code></pre></td>
<td class="coverage">200x</td>
</tr>
<tr class="covered">
<td class="num">281</td>
<td class="src"><pre><code class="objc">        // From the documentation: The managed object context&#65533;&#65533;&#65533;s change processing is explicitly disabled around this method so that you can use public setters to establish transient values and other caches without dirtying the object or its context.</code></pre></td>
<td class="coverage">125x</td>
</tr>
<tr class="covered">
<td class="num">282</td>
<td class="src"><pre><code class="objc">        // Therefore we need to do a dispatch async  here in a performGroupedBlock to update the unread properties outside of awakeFromFetch</code></pre></td>
<td class="coverage">125x</td>
</tr>
<tr class="covered">
<td class="num">283</td>
<td class="src"><pre><code class="objc">        [self.managedObjectContext performGroupedBlock:^{</code></pre></td>
<td class="coverage">125x</td>
</tr>
<tr class="covered">
<td class="num">284</td>
<td class="src"><pre><code class="objc">            [self didUpdateConversationWhileFetchingUnreadMessages];</code></pre></td>
<td class="coverage">125x</td>
</tr>
<tr class="covered">
<td class="num">285</td>
<td class="src"><pre><code class="objc">        }];</code></pre></td>
<td class="coverage">125x</td>
</tr>
<tr class="covered">
<td class="num">286</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">125x</td>
</tr>
<tr class="covered">
<td class="num">287</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">200x</td>
</tr>
<tr class="never">
<td class="num">288</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">289</td>
<td class="src"><pre><code class="objc">- (void)awakeFromInsert;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">290</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">3230x</td>
</tr>
<tr class="covered">
<td class="num">291</td>
<td class="src"><pre><code class="objc">    [super awakeFromInsert];</code></pre></td>
<td class="coverage">3230x</td>
</tr>
<tr class="covered">
<td class="num">292</td>
<td class="src"><pre><code class="objc">    self.lastReadEventIDSaveDelay = ZMConversationDefaultLastReadEventIDSaveDelay;</code></pre></td>
<td class="coverage">3230x</td>
</tr>
<tr class="covered">
<td class="num">293</td>
<td class="src"><pre><code class="objc">    if (self.managedObjectContext.zm_isSyncContext) {</code></pre></td>
<td class="coverage">3230x</td>
</tr>
<tr class="covered">
<td class="num">294</td>
<td class="src"><pre><code class="objc">        // From the documentation: You are typically discouraged from performing fetches within an implementation of awakeFromInsert. Although it is allowed, execution of the fetch request can trigger the sending of internal Core Data notifications which may have unwanted side-effects. Since we fetch the unread messages here, we should do a dispatch async</code></pre></td>
<td class="coverage">370x</td>
</tr>
<tr class="covered">
<td class="num">295</td>
<td class="src"><pre><code class="objc">        [self.managedObjectContext performGroupedBlock:^{</code></pre></td>
<td class="coverage">370x</td>
</tr>
<tr class="covered">
<td class="num">296</td>
<td class="src"><pre><code class="objc">            [self didUpdateConversationWhileFetchingUnreadMessages];</code></pre></td>
<td class="coverage">370x</td>
</tr>
<tr class="covered">
<td class="num">297</td>
<td class="src"><pre><code class="objc">        }];</code></pre></td>
<td class="coverage">370x</td>
</tr>
<tr class="covered">
<td class="num">298</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">370x</td>
</tr>
<tr class="covered">
<td class="num">299</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">3230x</td>
</tr>
<tr class="never">
<td class="num">300</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">301</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">302</td>
<td class="src"><pre><code class="objc">-(NSOrderedSet *)activeParticipants</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">303</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">304</td>
<td class="src"><pre><code class="objc">    NSMutableOrderedSet *activeParticipants = [NSMutableOrderedSet orderedSet];</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">305</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">306</td>
<td class="src"><pre><code class="objc">    if (self.conversationType != ZMConversationTypeGroup) {</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">307</td>
<td class="src"><pre><code class="objc">        [activeParticipants addObject:[ZMUser selfUserInContext:self.managedObjectContext]];</code></pre></td>
<td class="coverage">596x</td>
</tr>
<tr class="covered">
<td class="num">308</td>
<td class="src"><pre><code class="objc">        if (self.connectedUser != nil) {</code></pre></td>
<td class="coverage">596x</td>
</tr>
<tr class="covered">
<td class="num">309</td>
<td class="src"><pre><code class="objc">            [activeParticipants addObject:self.connectedUser];</code></pre></td>
<td class="coverage">13x</td>
</tr>
<tr class="covered">
<td class="num">310</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">13x</td>
</tr>
<tr class="covered">
<td class="num">311</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">596x</td>
</tr>
<tr class="covered">
<td class="num">312</td>
<td class="src"><pre><code class="objc">    else if(self.isSelfAnActiveMember) {</code></pre></td>
<td class="coverage">1320x</td>
</tr>
<tr class="covered">
<td class="num">313</td>
<td class="src"><pre><code class="objc">        [activeParticipants addObject:[ZMUser selfUserInContext:self.managedObjectContext]];</code></pre></td>
<td class="coverage">1320x</td>
</tr>
<tr class="covered">
<td class="num">314</td>
<td class="src"><pre><code class="objc">        [activeParticipants unionOrderedSet:self.otherActiveParticipants];</code></pre></td>
<td class="coverage">1320x</td>
</tr>
<tr class="covered">
<td class="num">315</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">1320x</td>
</tr>
<tr class="covered">
<td class="num">316</td>
<td class="src"><pre><code class="objc">    else</code></pre></td>
<td class="coverage">1320x</td>
</tr>
<tr class="covered">
<td class="num">317</td>
<td class="src"><pre><code class="objc">    {</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="covered">
<td class="num">318</td>
<td class="src"><pre><code class="objc">        [activeParticipants unionOrderedSet:self.otherActiveParticipants];</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="covered">
<td class="num">319</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="covered">
<td class="num">320</td>
<td class="src"><pre><code class="objc">   </code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">321</td>
<td class="src"><pre><code class="objc">    NSArray *sortedParticipants = [self sortedUsers:activeParticipants];</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">322</td>
<td class="src"><pre><code class="objc">    return [NSOrderedSet orderedSetWithArray:sortedParticipants];</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">323</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="never">
<td class="num">324</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">325</td>
<td class="src"><pre><code class="objc">- (NSArray *)sortedUsers:(NSOrderedSet *)users</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">326</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">327</td>
<td class="src"><pre><code class="objc">    NSSortDescriptor *nameDescriptor = [NSSortDescriptor sortDescriptorWithKey:@"normalizedName" ascending:YES];</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">328</td>
<td class="src"><pre><code class="objc">    NSArray *sortedUser = [users sortedArrayUsingDescriptors:@[nameDescriptor]];</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">329</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">330</td>
<td class="src"><pre><code class="objc">    return sortedUser;</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="covered">
<td class="num">331</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">1920x</td>
</tr>
<tr class="never">
<td class="num">332</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">333</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingActiveParticipants</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">334</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">335</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObjects:ZMConversationOtherActiveParticipantsKey, ZMConversationIsSelfAnActiveMemberKey, nil];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">336</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">337</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">338</td>
<td class="src"><pre><code class="objc">-(NSOrderedSet *)inactiveParticipants</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">339</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">64x</td>
</tr>
<tr class="covered">
<td class="num">340</td>
<td class="src"><pre><code class="objc">    if (self.conversationType != ZMConversationTypeGroup) {</code></pre></td>
<td class="coverage">64x</td>
</tr>
<tr class="covered">
<td class="num">341</td>
<td class="src"><pre><code class="objc">        return [NSOrderedSet orderedSet];</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">342</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">343</td>
<td class="src"><pre><code class="objc">    if(self.isSelfAnActiveMember)</code></pre></td>
<td class="coverage">52x</td>
</tr>
<tr class="covered">
<td class="num">344</td>
<td class="src"><pre><code class="objc">    {</code></pre></td>
<td class="coverage">48x</td>
</tr>
<tr class="covered">
<td class="num">345</td>
<td class="src"><pre><code class="objc">        return self.otherInactiveParticipants;</code></pre></td>
<td class="coverage">48x</td>
</tr>
<tr class="covered">
<td class="num">346</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">48x</td>
</tr>
<tr class="covered">
<td class="num">347</td>
<td class="src"><pre><code class="objc">    else {</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">348</td>
<td class="src"><pre><code class="objc">        NSMutableOrderedSet *otherInactive = [self.otherInactiveParticipants mutableCopy];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">349</td>
<td class="src"><pre><code class="objc">        [otherInactive addObject:[ZMUser selfUserInContext:self.managedObjectContext]];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">350</td>
<td class="src"><pre><code class="objc">        return otherInactive;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">351</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">352</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">52x</td>
</tr>
<tr class="never">
<td class="num">353</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">354</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingInactiveParticipants</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">355</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">356</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObjects:OtherInactiveParticipantsKey, ZMConversationIsSelfAnActiveMemberKey, nil];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">357</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">358</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">359</td>
<td class="src"><pre><code class="objc">- (NSOrderedSet *)allParticipants;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">360</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">40x</td>
</tr>
<tr class="covered">
<td class="num">361</td>
<td class="src"><pre><code class="objc">    NSMutableOrderedSet *result = [self.activeParticipants mutableCopy];</code></pre></td>
<td class="coverage">40x</td>
</tr>
<tr class="covered">
<td class="num">362</td>
<td class="src"><pre><code class="objc">    [result unionOrderedSet:self.inactiveParticipants];</code></pre></td>
<td class="coverage">40x</td>
</tr>
<tr class="covered">
<td class="num">363</td>
<td class="src"><pre><code class="objc">    return result;</code></pre></td>
<td class="coverage">40x</td>
</tr>
<tr class="covered">
<td class="num">364</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">40x</td>
</tr>
<tr class="never">
<td class="num">365</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">366</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingAllParticipants;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">367</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">368</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObjects:ZMConversationOtherActiveParticipantsKey, OtherInactiveParticipantsKey, ZMConversationIsSelfAnActiveMemberKey, nil];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">369</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">370</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">371</td>
<td class="src"><pre><code class="objc">- (ZMUser *)connectedUser</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">372</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">5070x</td>
</tr>
<tr class="covered">
<td class="num">373</td>
<td class="src"><pre><code class="objc">    if(self.conversationType == ZMConversationTypeOneOnOne || self.conversationType == ZMConversationTypeConnection) {</code></pre></td>
<td class="coverage">5070x</td>
</tr>
<tr class="covered">
<td class="num">374</td>
<td class="src"><pre><code class="objc">        return self.connection.to;</code></pre></td>
<td class="coverage">594x</td>
</tr>
<tr class="covered">
<td class="num">375</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">594x</td>
</tr>
<tr class="covered">
<td class="num">376</td>
<td class="src"><pre><code class="objc">    return nil;</code></pre></td>
<td class="coverage">4480x</td>
</tr>
<tr class="covered">
<td class="num">377</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">5070x</td>
</tr>
<tr class="never">
<td class="num">378</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">379</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingConnectedUser</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">380</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">381</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObject:ConversationTypeKey];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">382</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">383</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">384</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">385</td>
<td class="src"><pre><code class="objc">- (ZMConnectionStatus)relatedConnectionState</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">386</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">3740x</td>
</tr>
<tr class="covered">
<td class="num">387</td>
<td class="src"><pre><code class="objc">    if(self.connection != nil) {</code></pre></td>
<td class="coverage">3740x</td>
</tr>
<tr class="covered">
<td class="num">388</td>
<td class="src"><pre><code class="objc">        return self.connection.status;</code></pre></td>
<td class="coverage">187x</td>
</tr>
<tr class="covered">
<td class="num">389</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">187x</td>
</tr>
<tr class="covered">
<td class="num">390</td>
<td class="src"><pre><code class="objc">    return ZMConnectionStatusInvalid;</code></pre></td>
<td class="coverage">3550x</td>
</tr>
<tr class="covered">
<td class="num">391</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">3740x</td>
</tr>
<tr class="never">
<td class="num">392</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">393</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingRelatedConnectionState</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">394</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2310x</td>
</tr>
<tr class="covered">
<td class="num">395</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObject:@"connection"];</code></pre></td>
<td class="coverage">2310x</td>
</tr>
<tr class="covered">
<td class="num">396</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2310x</td>
</tr>
<tr class="never">
<td class="num">397</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">398</td>
<td class="src"><pre><code class="objc">- (NSSet *)ignoredKeys;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">399</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">16200x</td>
</tr>
<tr class="covered">
<td class="num">400</td>
<td class="src"><pre><code class="objc">    static NSSet *ignoredKeys;</code></pre></td>
<td class="coverage">16200x</td>
</tr>
<tr class="covered">
<td class="num">401</td>
<td class="src"><pre><code class="objc">    static dispatch_once_t onceToken;</code></pre></td>
<td class="coverage">16200x</td>
</tr>
<tr class="covered">
<td class="num">402</td>
<td class="src"><pre><code class="objc">    dispatch_once(&amp;onceToken, ^{</code></pre></td>
<td class="coverage">16200x</td>
</tr>
<tr class="covered">
<td class="num">403</td>
<td class="src"><pre><code class="objc">        NSSet *keys = [super ignoredKeys];</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">404</td>
<td class="src"><pre><code class="objc">        NSString * const KeysIgnoredForTrackingModifications[] = {</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">405</td>
<td class="src"><pre><code class="objc">            ZMConversationCallParticipantsKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">406</td>
<td class="src"><pre><code class="objc">            CallStateNeedsToBeUpdatedFromBackendKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">407</td>
<td class="src"><pre><code class="objc">            ZMConversationConnectionKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">408</td>
<td class="src"><pre><code class="objc">            ConversationTypeKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">409</td>
<td class="src"><pre><code class="objc">            CreatorKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">410</td>
<td class="src"><pre><code class="objc">            ZMConversationLastReadEventIDDataKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">411</td>
<td class="src"><pre><code class="objc">            DownloadedMessageIDsDataKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">412</td>
<td class="src"><pre><code class="objc">            DraftMessageTextKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">413</td>
<td class="src"><pre><code class="objc">            LastEventIDDataKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">414</td>
<td class="src"><pre><code class="objc">            LastModifiedDateKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">415</td>
<td class="src"><pre><code class="objc">            LastServerSyncedActiveParticipantsKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">416</td>
<td class="src"><pre><code class="objc">            ZMNormalizedUserDefinedNameKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">417</td>
<td class="src"><pre><code class="objc">            ZMConversationOtherActiveParticipantsKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">418</td>
<td class="src"><pre><code class="objc">            OtherInactiveParticipantsKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">419</td>
<td class="src"><pre><code class="objc">            VoiceChannelKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">420</td>
<td class="src"><pre><code class="objc">            ZMConversationArchivedEventIDKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">421</td>
<td class="src"><pre><code class="objc">            ZMConversationHasUnreadMissedCallKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">422</td>
<td class="src"><pre><code class="objc">            ZMConversationHasUnreadUnsentMessageKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">423</td>
<td class="src"><pre><code class="objc">            ZMConversationMessagesKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">424</td>
<td class="src"><pre><code class="objc">            ZMConversationHiddenMessagesKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">425</td>
<td class="src"><pre><code class="objc">            ZMConversationLastServerTimeStampKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">426</td>
<td class="src"><pre><code class="objc">            SecurityLevelKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">427</td>
<td class="src"><pre><code class="objc">            ZMConversationLastUnreadKnockDateKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">428</td>
<td class="src"><pre><code class="objc">            ZMConversationLastUnreadMissedCallDateKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">429</td>
<td class="src"><pre><code class="objc">            ZMConversationLastReadLocalTimestampKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">430</td>
<td class="src"><pre><code class="objc">            ZMConversationInternalEstimatedUnreadCountKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">431</td>
<td class="src"><pre><code class="objc">            ZMConversationIsArchivedKey,</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">432</td>
<td class="src"><pre><code class="objc">            ZMConversationIsSilencedKey</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">433</td>
<td class="src"><pre><code class="objc">        };</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">434</td>
<td class="src"><pre><code class="objc">        </code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">435</td>
<td class="src"><pre><code class="objc">        NSSet *additionalKeys = [NSSet setWithObjects:KeysIgnoredForTrackingModifications count:(sizeof(KeysIgnoredForTrackingModifications) / sizeof(*KeysIgnoredForTrackingModifications))];</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">436</td>
<td class="src"><pre><code class="objc">        ignoredKeys = [keys setByAddingObjectsFromSet:additionalKeys];</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">437</td>
<td class="src"><pre><code class="objc">    });</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">438</td>
<td class="src"><pre><code class="objc">    return ignoredKeys;</code></pre></td>
<td class="coverage">16200x</td>
</tr>
<tr class="covered">
<td class="num">439</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">16200x</td>
</tr>
<tr class="never">
<td class="num">440</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">441</td>
<td class="src"><pre><code class="objc">- (BOOL)isReadOnly</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">442</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">81x</td>
</tr>
<tr class="covered">
<td class="num">443</td>
<td class="src"><pre><code class="objc">    return</code></pre></td>
<td class="coverage">81x</td>
</tr>
<tr class="covered">
<td class="num">444</td>
<td class="src"><pre><code class="objc">    (self.conversationType == ZMConversationTypeInvalid) ||</code></pre></td>
<td class="coverage">81x</td>
</tr>
<tr class="covered">
<td class="num">445</td>
<td class="src"><pre><code class="objc">    (self.conversationType == ZMConversationTypeSelf) ||</code></pre></td>
<td class="coverage">79x</td>
</tr>
<tr class="covered">
<td class="num">446</td>
<td class="src"><pre><code class="objc">    (self.conversationType == ZMConversationTypeConnection) ||</code></pre></td>
<td class="coverage">79x</td>
</tr>
<tr class="covered">
<td class="num">447</td>
<td class="src"><pre><code class="objc">    (self.conversationType == ZMConversationTypeGroup &amp;&amp; !self.isSelfAnActiveMember);</code></pre></td>
<td class="coverage">34x</td>
</tr>
<tr class="covered">
<td class="num">448</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">81x</td>
</tr>
<tr class="never">
<td class="num">449</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">450</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingIsReadOnly;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">451</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">452</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObjects:ConversationTypeKey, ZMConversationIsSelfAnActiveMemberKey, nil];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">453</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">454</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">455</td>
<td class="src"><pre><code class="objc">- (NSString *)displayName</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">456</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4170x</td>
</tr>
<tr class="covered">
<td class="num">457</td>
<td class="src"><pre><code class="objc">    NSAttributedString *s = self.attributedDisplayName;</code></pre></td>
<td class="coverage">4170x</td>
</tr>
<tr class="covered">
<td class="num">458</td>
<td class="src"><pre><code class="objc">    NSString *result;</code></pre></td>
<td class="coverage">4170x</td>
</tr>
<tr class="covered">
<td class="num">459</td>
<td class="src"><pre><code class="objc">    if (0 &lt; s.length) {</code></pre></td>
<td class="coverage">4170x</td>
</tr>
<tr class="covered">
<td class="num">460</td>
<td class="src"><pre><code class="objc">        // Get the range of the first part that is not dimmed:</code></pre></td>
<td class="coverage">445x</td>
</tr>
<tr class="covered">
<td class="num">461</td>
<td class="src"><pre><code class="objc">        NSRange range = {};</code></pre></td>
<td class="coverage">445x</td>
</tr>
<tr class="covered">
<td class="num">462</td>
<td class="src"><pre><code class="objc">        NSNumber *isDimmed = [s attribute:ZMIsDimmedKey atIndex:0 longestEffectiveRange:&amp;range inRange:NSMakeRange(0, s.length)];</code></pre></td>
<td class="coverage">445x</td>
</tr>
<tr class="covered">
<td class="num">463</td>
<td class="src"><pre><code class="objc">        if (! [isDimmed boolValue]) {</code></pre></td>
<td class="coverage">445x</td>
</tr>
<tr class="covered">
<td class="num">464</td>
<td class="src"><pre><code class="objc">            result = [s.string substringWithRange:range];</code></pre></td>
<td class="coverage">445x</td>
</tr>
<tr class="covered">
<td class="num">465</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">445x</td>
</tr>
<tr class="covered">
<td class="num">466</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">445x</td>
</tr>
<tr class="covered">
<td class="num">467</td>
<td class="src"><pre><code class="objc">    if ((result.length &lt; 1) &amp;&amp; (self.conversationType == ZMConversationTypeGroup)) {</code></pre></td>
<td class="coverage">4170x</td>
</tr>
<tr class="covered">
<td class="num">468</td>
<td class="src"><pre><code class="objc">        return NSLocalizedString(@"conversation.displayname.emptygroup", @"");</code></pre></td>
<td class="coverage">281x</td>
</tr>
<tr class="covered">
<td class="num">469</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">281x</td>
</tr>
<tr class="covered">
<td class="num">470</td>
<td class="src"><pre><code class="objc">    return result ?: @"";</code></pre></td>
<td class="coverage">3890x</td>
</tr>
<tr class="covered">
<td class="num">471</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4170x</td>
</tr>
<tr class="never">
<td class="num">472</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">473</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingAttributedDisplayName;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">474</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">475</td>
<td class="src"><pre><code class="objc">    NSMutableSet *finalSet = [NSMutableSet setWithSet:[ZMConversation keyPathsForValuesAffectingDisplayName]];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">476</td>
<td class="src"><pre><code class="objc">    [finalSet addObject: [NSString stringWithFormat:@"%@.%@", OtherInactiveParticipantsKey, @"displayName"]];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">477</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">478</td>
<td class="src"><pre><code class="objc">    return finalSet;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">479</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">480</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">481</td>
<td class="src"><pre><code class="objc">- (NSAttributedString *)attributedDisplayName</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">482</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4170x</td>
</tr>
<tr class="covered">
<td class="num">483</td>
<td class="src"><pre><code class="objc">    switch (self.conversationType) {</code></pre></td>
<td class="coverage">4170x</td>
</tr>
<tr class="covered">
<td class="num">484</td>
<td class="src"><pre><code class="objc">        case ZMConversationTypeConnection:</code></pre></td>
<td class="coverage">90x</td>
</tr>
<tr class="covered">
<td class="num">485</td>
<td class="src"><pre><code class="objc">        {</code></pre></td>
<td class="coverage">90x</td>
</tr>
<tr class="covered">
<td class="num">486</td>
<td class="src"><pre><code class="objc">            NSString *name = self.connectedUser.name;</code></pre></td>
<td class="coverage">90x</td>
</tr>
<tr class="covered">
<td class="num">487</td>
<td class="src"><pre><code class="objc">            if (name.length == 0) {</code></pre></td>
<td class="coverage">90x</td>
</tr>
<tr class="covered">
<td class="num">488</td>
<td class="src"><pre><code class="objc">                name = self.userDefinedName;</code></pre></td>
<td class="coverage">72x</td>
</tr>
<tr class="covered">
<td class="num">489</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">72x</td>
</tr>
<tr class="covered">
<td class="num">490</td>
<td class="src"><pre><code class="objc">            return [[NSAttributedString alloc] initWithString:name ?: @"&#65533;&#65533;&#65533;"];</code></pre></td>
<td class="coverage">58x</td>
</tr>
<tr class="covered">
<td class="num">491</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">90x</td>
</tr>
<tr class="missed">
<td class="num">492</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">493</td>
<td class="src"><pre><code class="objc">        case ZMConversationTypeGroup:</code></pre></td>
<td class="coverage">409x</td>
</tr>
<tr class="covered">
<td class="num">494</td>
<td class="src"><pre><code class="objc">            if (0 &lt; self.userDefinedName.length) {</code></pre></td>
<td class="coverage">409x</td>
</tr>
<tr class="covered">
<td class="num">495</td>
<td class="src"><pre><code class="objc">                return [[NSAttributedString alloc] initWithString:self.userDefinedName];</code></pre></td>
<td class="coverage">72x</td>
</tr>
<tr class="covered">
<td class="num">496</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">72x</td>
</tr>
<tr class="covered">
<td class="num">497</td>
<td class="src"><pre><code class="objc">            else {</code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">498</td>
<td class="src"><pre><code class="objc">                ZMUser *selfUser = [ZMUser selfUserInContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">499</td>
<td class="src"><pre><code class="objc">                NSArray *activeNames = [self.otherActiveParticipants.array mapWithBlock:^NSString*(ZMUser *user) {</code></pre></td>
<td class="coverage">375x</td>
</tr>
<tr class="covered">
<td class="num">500</td>
<td class="src"><pre><code class="objc">                    if(user == selfUser || user.name.length &lt; 1) {</code></pre></td>
<td class="coverage">375x</td>
</tr>
<tr class="covered">
<td class="num">501</td>
<td class="src"><pre><code class="objc">                        return nil;</code></pre></td>
<td class="coverage">295x</td>
</tr>
<tr class="covered">
<td class="num">502</td>
<td class="src"><pre><code class="objc">                    }</code></pre></td>
<td class="coverage">295x</td>
</tr>
<tr class="covered">
<td class="num">503</td>
<td class="src"><pre><code class="objc">                    return user.displayName;</code></pre></td>
<td class="coverage">80x</td>
</tr>
<tr class="covered">
<td class="num">504</td>
<td class="src"><pre><code class="objc">                }];</code></pre></td>
<td class="coverage">375x</td>
</tr>
<tr class="covered">
<td class="num">505</td>
<td class="src"><pre><code class="objc">                </code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">506</td>
<td class="src"><pre><code class="objc">                NSArray *inactiveNames = [self.otherInactiveParticipants.array mapWithBlock:^NSString*(ZMUser *user) {</code></pre></td>
<td class="coverage">54x</td>
</tr>
<tr class="covered">
<td class="num">507</td>
<td class="src"><pre><code class="objc">                    if(user == selfUser || user.name.length &lt; 1) {</code></pre></td>
<td class="coverage">54x</td>
</tr>
<tr class="covered">
<td class="num">508</td>
<td class="src"><pre><code class="objc">                        return nil;</code></pre></td>
<td class="coverage">34x</td>
</tr>
<tr class="covered">
<td class="num">509</td>
<td class="src"><pre><code class="objc">                    }</code></pre></td>
<td class="coverage">34x</td>
</tr>
<tr class="covered">
<td class="num">510</td>
<td class="src"><pre><code class="objc">                    return user.displayName;</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">511</td>
<td class="src"><pre><code class="objc">                }];</code></pre></td>
<td class="coverage">54x</td>
</tr>
<tr class="covered">
<td class="num">512</td>
<td class="src"><pre><code class="objc">                </code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">513</td>
<td class="src"><pre><code class="objc">                NSString *joiner = @", ";</code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">514</td>
<td class="src"><pre><code class="objc">                NSDictionary *dimmed = @{ZMIsDimmedKey: @YES};</code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">515</td>
<td class="src"><pre><code class="objc">                NSString *activeNamesString = [activeNames componentsJoinedByString:joiner];</code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">516</td>
<td class="src"><pre><code class="objc">                NSString *inactiveNamesString = [inactiveNames componentsJoinedByString:joiner];</code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">517</td>
<td class="src"><pre><code class="objc">                </code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">518</td>
<td class="src"><pre><code class="objc">                NSMutableAttributedString *allNames = [[NSMutableAttributedString alloc] initWithString:activeNamesString attributes:@{}];</code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">519</td>
<td class="src"><pre><code class="objc">                </code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">520</td>
<td class="src"><pre><code class="objc">                if (inactiveNamesString.length &gt; 0) {</code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">521</td>
<td class="src"><pre><code class="objc">                    NSAttributedString *attributedInactiveNames = [[NSAttributedString alloc] initWithString:inactiveNamesString attributes:dimmed];</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">522</td>
<td class="src"><pre><code class="objc">                    [allNames appendAttributedString:[[NSAttributedString alloc] initWithString:joiner attributes:dimmed]];</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">523</td>
<td class="src"><pre><code class="objc">                    [allNames appendAttributedString:attributedInactiveNames];</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">524</td>
<td class="src"><pre><code class="objc">                }</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">525</td>
<td class="src"><pre><code class="objc">                </code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">526</td>
<td class="src"><pre><code class="objc">                return allNames;</code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">527</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">337x</td>
</tr>
<tr class="covered">
<td class="num">528</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">409x</td>
</tr>
<tr class="missed">
<td class="num">529</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">530</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">409x</td>
</tr>
<tr class="covered">
<td class="num">531</td>
<td class="src"><pre><code class="objc">        case ZMConversationTypeOneOnOne:</code></pre></td>
<td class="coverage">231x</td>
</tr>
<tr class="covered">
<td class="num">532</td>
<td class="src"><pre><code class="objc">        {</code></pre></td>
<td class="coverage">231x</td>
</tr>
<tr class="covered">
<td class="num">533</td>
<td class="src"><pre><code class="objc">            ZMUser *other = self.otherActiveParticipants.firstObject ?: self.connectedUser;</code></pre></td>
<td class="coverage">162x</td>
</tr>
<tr class="covered">
<td class="num">534</td>
<td class="src"><pre><code class="objc">            NSString *name = other.name;</code></pre></td>
<td class="coverage">231x</td>
</tr>
<tr class="covered">
<td class="num">535</td>
<td class="src"><pre><code class="objc">            if (0 &lt; name.length) {</code></pre></td>
<td class="coverage">231x</td>
</tr>
<tr class="covered">
<td class="num">536</td>
<td class="src"><pre><code class="objc">                return [[NSAttributedString alloc] initWithString:name];</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">537</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">538</td>
<td class="src"><pre><code class="objc">            else {</code></pre></td>
<td class="coverage">209x</td>
</tr>
<tr class="covered">
<td class="num">539</td>
<td class="src"><pre><code class="objc">                // The user is most probably deleted</code></pre></td>
<td class="coverage">209x</td>
</tr>
<tr class="covered">
<td class="num">540</td>
<td class="src"><pre><code class="objc">                return [[NSAttributedString alloc] initWithString:@"&#65533;&#65533;&#65533;"];</code></pre></td>
<td class="coverage">209x</td>
</tr>
<tr class="covered">
<td class="num">541</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">209x</td>
</tr>
<tr class="covered">
<td class="num">542</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">231x</td>
</tr>
<tr class="missed">
<td class="num">543</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">544</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">231x</td>
</tr>
<tr class="covered">
<td class="num">545</td>
<td class="src"><pre><code class="objc">        case ZMConversationTypeSelf:</code></pre></td>
<td class="coverage">1650x</td>
</tr>
<tr class="missed">
<td class="num">546</td>
<td class="src"><pre><code class="objc">            return [[NSAttributedString alloc] initWithString:[ZMUser selfUserInContext:self.managedObjectContext].displayName ?: @""];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">547</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">548</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">231x</td>
</tr>
<tr class="covered">
<td class="num">549</td>
<td class="src"><pre><code class="objc">        case ZMConversationTypeInvalid:</code></pre></td>
<td class="coverage">1790x</td>
</tr>
<tr class="covered">
<td class="num">550</td>
<td class="src"><pre><code class="objc">            return [[NSAttributedString alloc] initWithString:@""];</code></pre></td>
<td class="coverage">1790x</td>
</tr>
<tr class="missed">
<td class="num">551</td>
<td class="src"><pre><code class="objc">            break;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">552</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4170x</td>
</tr>
<tr class="covered">
<td class="num">553</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4170x</td>
</tr>
<tr class="never">
<td class="num">554</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">555</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingDisplayName;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">556</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">557</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObjects:ConversationTypeKey, @"connection",</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">558</td>
<td class="src"><pre><code class="objc">            ZMConversationUserDefinedNameKey, nil];</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">559</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="never">
<td class="num">560</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">561</td>
<td class="src"><pre><code class="objc">+ (instancetype)insertGroupConversationIntoUserSession:(id&lt;ZMManagedObjectContextProvider&gt;)session withParticipants:(NSArray *)participants</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">562</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">563</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(session != nil);</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">564</td>
<td class="src"><pre><code class="objc">    return [self insertGroupConversationIntoManagedObjectContext:session.managedObjectContext withParticipants:participants];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">565</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">566</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">567</td>
<td class="src"><pre><code class="objc">+ (instancetype)existingOneOnOneConversationWithUser:(ZMUser *)otherUser inUserSession:(id&lt;ZMManagedObjectContextProvider&gt;)session;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">568</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">569</td>
<td class="src"><pre><code class="objc">    NOT_USED(session);</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">570</td>
<td class="src"><pre><code class="objc">    return otherUser.connection.conversation;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">571</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">572</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">573</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">574</td>
<td class="src"><pre><code class="objc">- (void)setClearedEventID:(ZMEventID *)clearedEventID</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">575</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">576</td>
<td class="src"><pre><code class="objc">    [self setTransientEventID:clearedEventID forKey:ZMConversationClearedEventIDKey];</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">577</td>
<td class="src"><pre><code class="objc">    [self closeEventIDGap];</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">578</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="never">
<td class="num">579</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">580</td>
<td class="src"><pre><code class="objc">- (void)closeEventIDGap</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">581</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">582</td>
<td class="src"><pre><code class="objc">    if (self.clearedEventID != nil) {</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">583</td>
<td class="src"><pre><code class="objc">        ZMEventID *lowestEventID = [ZMEventID eventIDWithMajor:1 minor:0];</code></pre></td>
<td class="coverage">37x</td>
</tr>
<tr class="covered">
<td class="num">584</td>
<td class="src"><pre><code class="objc">        ZMEventIDRange *range = [[ZMEventIDRange alloc] initWithEventIDs:@[lowestEventID, self.clearedEventID]];</code></pre></td>
<td class="coverage">37x</td>
</tr>
<tr class="covered">
<td class="num">585</td>
<td class="src"><pre><code class="objc">        [self addEventRangeToDownloadedEvents:range];</code></pre></td>
<td class="coverage">37x</td>
</tr>
<tr class="covered">
<td class="num">586</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">37x</td>
</tr>
<tr class="covered">
<td class="num">587</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="never">
<td class="num">588</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">589</td>
<td class="src"><pre><code class="objc">- (void)setClearedTimeStamp:(NSDate *)clearedTimeStamp</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">590</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">63x</td>
</tr>
<tr class="covered">
<td class="num">591</td>
<td class="src"><pre><code class="objc">    [self willChangeValueForKey:ZMConversationClearedTimeStampKey];</code></pre></td>
<td class="coverage">63x</td>
</tr>
<tr class="covered">
<td class="num">592</td>
<td class="src"><pre><code class="objc">    [self setPrimitiveValue:clearedTimeStamp forKey:ZMConversationClearedTimeStampKey];</code></pre></td>
<td class="coverage">63x</td>
</tr>
<tr class="covered">
<td class="num">593</td>
<td class="src"><pre><code class="objc">    [self didChangeValueForKey:ZMConversationClearedTimeStampKey];</code></pre></td>
<td class="coverage">63x</td>
</tr>
<tr class="covered">
<td class="num">594</td>
<td class="src"><pre><code class="objc">    if (self.managedObjectContext.zm_isSyncContext) {</code></pre></td>
<td class="coverage">63x</td>
</tr>
<tr class="covered">
<td class="num">595</td>
<td class="src"><pre><code class="objc">        [self deleteOlderMessages];</code></pre></td>
<td class="coverage">18x</td>
</tr>
<tr class="covered">
<td class="num">596</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">18x</td>
</tr>
<tr class="covered">
<td class="num">597</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">63x</td>
</tr>
<tr class="never">
<td class="num">598</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">599</td>
<td class="src"><pre><code class="objc">- (void)setLastReadServerTimeStamp:(NSDate *)lastReadServerTimeStamp</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">600</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">857x</td>
</tr>
<tr class="covered">
<td class="num">601</td>
<td class="src"><pre><code class="objc">    [self willChangeValueForKey:ZMConversationLastReadServerTimeStampKey];</code></pre></td>
<td class="coverage">857x</td>
</tr>
<tr class="covered">
<td class="num">602</td>
<td class="src"><pre><code class="objc">    [self setPrimitiveValue:lastReadServerTimeStamp forKey:ZMConversationLastReadServerTimeStampKey];</code></pre></td>
<td class="coverage">857x</td>
</tr>
<tr class="covered">
<td class="num">603</td>
<td class="src"><pre><code class="objc">    [self didChangeValueForKey:ZMConversationLastReadServerTimeStampKey];</code></pre></td>
<td class="coverage">857x</td>
</tr>
<tr class="covered">
<td class="num">604</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">857x</td>
</tr>
<tr class="covered">
<td class="num">605</td>
<td class="src"><pre><code class="objc">    if (self.managedObjectContext.zm_isSyncContext) {</code></pre></td>
<td class="coverage">857x</td>
</tr>
<tr class="covered">
<td class="num">606</td>
<td class="src"><pre><code class="objc">        [self updateUnread];</code></pre></td>
<td class="coverage">84x</td>
</tr>
<tr class="covered">
<td class="num">607</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">84x</td>
</tr>
<tr class="covered">
<td class="num">608</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">857x</td>
</tr>
<tr class="never">
<td class="num">609</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">610</td>
<td class="src"><pre><code class="objc">- (ZMEventID *)lastEventID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">611</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">324x</td>
</tr>
<tr class="covered">
<td class="num">612</td>
<td class="src"><pre><code class="objc">    return [self transientEventIDForKey:LastEventIDKey];</code></pre></td>
<td class="coverage">324x</td>
</tr>
<tr class="covered">
<td class="num">613</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">324x</td>
</tr>
<tr class="never">
<td class="num">614</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">615</td>
<td class="src"><pre><code class="objc">- (void)setLastEventID:(ZMEventID *)newEventID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">616</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">622x</td>
</tr>
<tr class="covered">
<td class="num">617</td>
<td class="src"><pre><code class="objc">    [self setTransientEventID:newEventID forKey:LastEventIDKey];</code></pre></td>
<td class="coverage">622x</td>
</tr>
<tr class="covered">
<td class="num">618</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">622x</td>
</tr>
<tr class="never">
<td class="num">619</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">620</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingLastEventID</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">621</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">622</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObject:LastEventIDDataKey];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">623</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">624</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">625</td>
<td class="src"><pre><code class="objc">- (ZMEventID *)lastReadEventID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">626</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">497x</td>
</tr>
<tr class="covered">
<td class="num">627</td>
<td class="src"><pre><code class="objc">    return [self transientEventIDForKey:LastReadEventIDKey];</code></pre></td>
<td class="coverage">497x</td>
</tr>
<tr class="covered">
<td class="num">628</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">497x</td>
</tr>
<tr class="never">
<td class="num">629</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">630</td>
<td class="src"><pre><code class="objc">- (void)setLastReadEventID:(ZMEventID *)newEventID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">631</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">188x</td>
</tr>
<tr class="covered">
<td class="num">632</td>
<td class="src"><pre><code class="objc">    [self setTransientEventID:newEventID forKey:LastReadEventIDKey];</code></pre></td>
<td class="coverage">188x</td>
</tr>
<tr class="covered">
<td class="num">633</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">188x</td>
</tr>
<tr class="never">
<td class="num">634</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">635</td>
<td class="src"><pre><code class="objc">- (ZMEventID *)archivedEventID</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">636</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">11x</td>
</tr>
<tr class="covered">
<td class="num">637</td>
<td class="src"><pre><code class="objc">    return [self transientEventIDForKey:ZMConversationArchivedEventIDKey];</code></pre></td>
<td class="coverage">11x</td>
</tr>
<tr class="covered">
<td class="num">638</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">11x</td>
</tr>
<tr class="never">
<td class="num">639</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">640</td>
<td class="src"><pre><code class="objc">- (void)setArchivedEventID:(ZMEventID *)archivedEventID</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">641</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">642</td>
<td class="src"><pre><code class="objc">    [self setTransientEventID:archivedEventID forKey:ZMConversationArchivedEventIDKey];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">643</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">644</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">645</td>
<td class="src"><pre><code class="objc">- (ZMEventID *)clearedEventID</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">646</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">969x</td>
</tr>
<tr class="covered">
<td class="num">647</td>
<td class="src"><pre><code class="objc">    return [self transientEventIDForKey:ZMConversationClearedEventIDKey];</code></pre></td>
<td class="coverage">969x</td>
</tr>
<tr class="covered">
<td class="num">648</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">969x</td>
</tr>
<tr class="never">
<td class="num">649</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">650</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingLastReadEventID</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">651</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">652</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObject:ZMConversationLastReadEventIDDataKey];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">653</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">654</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">655</td>
<td class="src"><pre><code class="objc">- (NSUUID *)remoteIdentifier;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">656</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">360x</td>
</tr>
<tr class="covered">
<td class="num">657</td>
<td class="src"><pre><code class="objc">    return [self transientUUIDForKey:RemoteIdentifierKey];</code></pre></td>
<td class="coverage">360x</td>
</tr>
<tr class="covered">
<td class="num">658</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">360x</td>
</tr>
<tr class="never">
<td class="num">659</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">660</td>
<td class="src"><pre><code class="objc">- (void)setRemoteIdentifier:(NSUUID *)remoteIdentifier;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">661</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2340x</td>
</tr>
<tr class="covered">
<td class="num">662</td>
<td class="src"><pre><code class="objc">    [self setTransientUUID:remoteIdentifier forKey:RemoteIdentifierKey];</code></pre></td>
<td class="coverage">2340x</td>
</tr>
<tr class="covered">
<td class="num">663</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2340x</td>
</tr>
<tr class="never">
<td class="num">664</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">665</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingRemoteIdentifier</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">666</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">667</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObject:ZMConversationRemoteIdentifierDataKey];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">668</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">669</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">670</td>
<td class="src"><pre><code class="objc">- (void)setUserDefinedName:(NSString *)aName {</code></pre></td>
<td class="coverage">220x</td>
</tr>
<tr class="covered">
<td class="num">671</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">220x</td>
</tr>
<tr class="covered">
<td class="num">672</td>
<td class="src"><pre><code class="objc">    [self willChangeValueForKey:ZMConversationUserDefinedNameKey];</code></pre></td>
<td class="coverage">220x</td>
</tr>
<tr class="covered">
<td class="num">673</td>
<td class="src"><pre><code class="objc">    [self setPrimitiveValue:[aName copy] forKey:ZMConversationUserDefinedNameKey];</code></pre></td>
<td class="coverage">220x</td>
</tr>
<tr class="covered">
<td class="num">674</td>
<td class="src"><pre><code class="objc">    [self didChangeValueForKey:ZMConversationUserDefinedNameKey];</code></pre></td>
<td class="coverage">220x</td>
</tr>
<tr class="covered">
<td class="num">675</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">220x</td>
</tr>
<tr class="covered">
<td class="num">676</td>
<td class="src"><pre><code class="objc">    self.normalizedUserDefinedName = [self.userDefinedName normalizedString];</code></pre></td>
<td class="coverage">220x</td>
</tr>
<tr class="covered">
<td class="num">677</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">220x</td>
</tr>
<tr class="never">
<td class="num">678</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">679</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">680</td>
<td class="src"><pre><code class="objc">+ (NSArray *)defaultSortDescriptors</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">681</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">1000x</td>
</tr>
<tr class="covered">
<td class="num">682</td>
<td class="src"><pre><code class="objc">    return @[[NSSortDescriptor sortDescriptorWithKey:ZMConversationIsArchivedKey ascending:YES],</code></pre></td>
<td class="coverage">1000x</td>
</tr>
<tr class="covered">
<td class="num">683</td>
<td class="src"><pre><code class="objc">             [NSSortDescriptor sortDescriptorWithKey:LastModifiedDateKey ascending:NO],</code></pre></td>
<td class="coverage">1000x</td>
</tr>
<tr class="covered">
<td class="num">684</td>
<td class="src"><pre><code class="objc">             [NSSortDescriptor sortDescriptorWithKey:ZMConversationRemoteIdentifierDataKey ascending:YES],];</code></pre></td>
<td class="coverage">1000x</td>
</tr>
<tr class="covered">
<td class="num">685</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">1000x</td>
</tr>
<tr class="never">
<td class="num">686</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">687</td>
<td class="src"><pre><code class="objc">- (void)addParticipant:(ZMUser *)participant</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">688</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">111x</td>
</tr>
<tr class="covered">
<td class="num">689</td>
<td class="src"><pre><code class="objc">    VerifyReturn(self.conversationType == ZMConversationTypeGroup);</code></pre></td>
<td class="coverage">111x</td>
</tr>
<tr class="covered">
<td class="num">690</td>
<td class="src"><pre><code class="objc">    RequireString(participant != [ZMUser selfUserInContext:self.managedObjectContext], "Can't add self user to a conversation");</code></pre></td>
<td class="coverage">109x</td>
</tr>
<tr class="covered">
<td class="num">691</td>
<td class="src"><pre><code class="objc">    [self internalAddParticipant:participant isAuthoritative:NO];</code></pre></td>
<td class="coverage">109x</td>
</tr>
<tr class="covered">
<td class="num">692</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">109x</td>
</tr>
<tr class="never">
<td class="num">693</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">694</td>
<td class="src"><pre><code class="objc">- (void)removeParticipant:(ZMUser *)participant;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">695</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">696</td>
<td class="src"><pre><code class="objc">    VerifyReturn(self.conversationType == ZMConversationTypeGroup);</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">697</td>
<td class="src"><pre><code class="objc">    ZMUser *selfUser = [ZMUser selfUserInContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">48x</td>
</tr>
<tr class="covered">
<td class="num">698</td>
<td class="src"><pre><code class="objc">    [self internalRemoveParticipant:participant sender:selfUser];</code></pre></td>
<td class="coverage">48x</td>
</tr>
<tr class="covered">
<td class="num">699</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">48x</td>
</tr>
<tr class="never">
<td class="num">700</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">701</td>
<td class="src"><pre><code class="objc">- (void)setVisibleWindowFromMessage:(ZMMessage *)oldestMessage toMessage:(ZMMessage *)newestMessage;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">702</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">703</td>
<td class="src"><pre><code class="objc">    ZMEventID *oldestEventId;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">704</td>
<td class="src"><pre><code class="objc">    ZMEventID *newestEventId;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">705</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">706</td>
<td class="src"><pre><code class="objc">    NSDate *oldestTimeStamp;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">707</td>
<td class="src"><pre><code class="objc">    NSDate *newestTimeStamp;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">708</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">709</td>
<td class="src"><pre><code class="objc">    if(oldestMessage) {</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">710</td>
<td class="src"><pre><code class="objc">        oldestEventId = oldestMessage.eventID;</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">711</td>
<td class="src"><pre><code class="objc">        oldestTimeStamp = oldestMessage.serverTimestamp;</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">712</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">713</td>
<td class="src"><pre><code class="objc">    if(newestMessage) {</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">714</td>
<td class="src"><pre><code class="objc">        newestEventId = newestMessage.eventID;</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">715</td>
<td class="src"><pre><code class="objc">        newestTimeStamp = newestMessage.serverTimestamp;</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">716</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">717</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">718</td>
<td class="src"><pre><code class="objc">    if (newestTimeStamp != nil &amp;&amp; oldestTimeStamp != nil &amp;&amp; [newestTimeStamp compare:oldestTimeStamp] == NSOrderedAscending) {</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">719</td>
<td class="src"><pre><code class="objc">        ZMEventID *tempID = oldestEventId;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">720</td>
<td class="src"><pre><code class="objc">        oldestEventId = newestEventId;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">721</td>
<td class="src"><pre><code class="objc">        newestEventId = tempID;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">722</td>
<td class="src"><pre><code class="objc">        </code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">723</td>
<td class="src"><pre><code class="objc">        ZMMessage *tempMsg = oldestMessage;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">724</td>
<td class="src"><pre><code class="objc">        oldestMessage = newestMessage;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">725</td>
<td class="src"><pre><code class="objc">        NOT_USED(oldestMessage);</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">726</td>
<td class="src"><pre><code class="objc">        newestMessage = tempMsg;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">727</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">728</td>
<td class="src"><pre><code class="objc">    [self updateLastReadServerTimeStampWithMessage:newestMessage];</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">729</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">730</td>
<td class="src"><pre><code class="objc">    NSMutableDictionary *userInfo = [NSMutableDictionary dictionary];</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">731</td>
<td class="src"><pre><code class="objc">    if(newestEventId != nil) {</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">732</td>
<td class="src"><pre><code class="objc">        userInfo[ZMVisibleWindowUpperKey] = newestEventId;</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">733</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">734</td>
<td class="src"><pre><code class="objc">    if(oldestEventId != nil) {</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">735</td>
<td class="src"><pre><code class="objc">        userInfo[ZMVisibleWindowLowerKey] = oldestEventId;</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">736</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">737</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">738</td>
<td class="src"><pre><code class="objc">    [[NSNotificationCenter defaultCenter] postNotificationName:ZMConversationDidChangeVisibleWindowNotification object:self userInfo:userInfo];</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">739</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">740</td>
<td class="src"><pre><code class="objc">    if (self.hasUnreadUnsentMessage) {</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">741</td>
<td class="src"><pre><code class="objc">        self.hasUnreadUnsentMessage = NO;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">742</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">743</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="never">
<td class="num">744</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">745</td>
<td class="src"><pre><code class="objc">- (void)savePendingLastRead</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">746</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">747</td>
<td class="src"><pre><code class="objc">    [self updateLastReadServerTimeStampIfNeededWithTimeStamp:self.tempMaxLastReadServerTimeStamp andSync:NO];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">748</td>
<td class="src"><pre><code class="objc">    self.tempMaxLastReadServerTimeStamp = nil;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">749</td>
<td class="src"><pre><code class="objc">    self.lastReadEventIDUpdateCounter = 0;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">750</td>
<td class="src"><pre><code class="objc">    [self.managedObjectContext enqueueDelayedSave];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">751</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="never">
<td class="num">752</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">753</td>
<td class="src"><pre><code class="objc">- (void)updateLastReadServerTimeStampWithMessage:(ZMMessage *)message</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">754</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">755</td>
<td class="src"><pre><code class="objc">    NSDate *timeStamp = message.serverTimestamp;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">756</td>
<td class="src"><pre><code class="objc">    BOOL senderIsSelfUser = message.sender.isSelfUser;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">757</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">758</td>
<td class="src"><pre><code class="objc">    if( ! self.managedObjectContext.zm_isUserInterfaceContext ) {</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="missed">
<td class="num">759</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">760</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">761</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">762</td>
<td class="src"><pre><code class="objc">    if (timeStamp == nil) {</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">763</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">764</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">765</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">766</td>
<td class="src"><pre><code class="objc">    if (self.lastReadServerTimeStamp != nil  &amp;&amp; [timeStamp compare:self.lastReadServerTimeStamp] == NSOrderedAscending) {</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">767</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">768</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">769</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">770</td>
<td class="src"><pre><code class="objc">    NSUInteger idx = [self.messages.array indexOfObjectIdenticalTo:message];</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">771</td>
<td class="src"><pre><code class="objc">    if (idx == NSNotFound) {</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">772</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">773</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">774</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">775</td>
<td class="src"><pre><code class="objc">    if (idx+1  == self.messages.count) {</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">776</td>
<td class="src"><pre><code class="objc">        timeStamp = self.lastServerTimeStamp;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">777</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">778</td>
<td class="src"><pre><code class="objc">    else if (message.deliveryState != ZMDeliveryStateDelivered) {</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">779</td>
<td class="src"><pre><code class="objc">        if (idx == 0) {</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="missed">
<td class="num">780</td>
<td class="src"><pre><code class="objc">            timeStamp = self.lastServerTimeStamp;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">781</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">782</td>
<td class="src"><pre><code class="objc">        else {</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">783</td>
<td class="src"><pre><code class="objc">            __block ZMMessage *lastDeliveredMessage;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">784</td>
<td class="src"><pre><code class="objc">            __block NSUInteger newIdx;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">785</td>
<td class="src"><pre><code class="objc">            [self.messages.array enumerateObjectsAtIndexes:[NSIndexSet indexSetWithIndexesInRange:NSMakeRange(0, idx)] options:NSEnumerationReverse usingBlock:^(ZMMessage *aMessage, NSUInteger anIdx, BOOL *stop) {</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">786</td>
<td class="src"><pre><code class="objc">                if (aMessage.deliveryState == ZMDeliveryStateDelivered) {</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="missed">
<td class="num">787</td>
<td class="src"><pre><code class="objc">                    lastDeliveredMessage = aMessage;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">788</td>
<td class="src"><pre><code class="objc">                    newIdx = anIdx;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">789</td>
<td class="src"><pre><code class="objc">                    *stop = YES;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">790</td>
<td class="src"><pre><code class="objc">                }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">791</td>
<td class="src"><pre><code class="objc">            }];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">792</td>
<td class="src"><pre><code class="objc">            if (lastDeliveredMessage == nil ||</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="missed">
<td class="num">793</td>
<td class="src"><pre><code class="objc">                [lastDeliveredMessage.serverTimestamp compare:self.lastReadServerTimeStamp] == NSOrderedAscending)</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">794</td>
<td class="src"><pre><code class="objc">            {</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">795</td>
<td class="src"><pre><code class="objc">                return;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">796</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="missed">
<td class="num">797</td>
<td class="src"><pre><code class="objc">            timeStamp = lastDeliveredMessage.serverTimestamp;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">798</td>
<td class="src"><pre><code class="objc">            senderIsSelfUser = lastDeliveredMessage.sender.isSelfUser;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">799</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">800</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">801</td>
<td class="src"><pre><code class="objc">    [self updateLastReadServerTimeStamp:timeStamp senderIsSelfUser:senderIsSelfUser];</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">802</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="never">
<td class="num">803</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">804</td>
<td class="src"><pre><code class="objc">- (void)updateLastReadServerTimeStamp:(NSDate *)serverTimeStamp senderIsSelfUser:(BOOL)senderIsSelfUser</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">805</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">806</td>
<td class="src"><pre><code class="objc">    if ((self.lastReadServerTimeStamp != nil) &amp;&amp;([serverTimeStamp compare:self.lastReadServerTimeStamp] == NSOrderedAscending)) {</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="missed">
<td class="num">807</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">808</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">809</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">810</td>
<td class="src"><pre><code class="objc">    if (self.tempMaxLastReadServerTimeStamp == nil ||  [self.tempMaxLastReadServerTimeStamp compare:serverTimeStamp] == NSOrderedAscending) {</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">811</td>
<td class="src"><pre><code class="objc">        if (!senderIsSelfUser) {</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">812</td>
<td class="src"><pre><code class="objc">            self.tempMaxLastReadServerTimeStamp = serverTimeStamp;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">813</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">814</td>
<td class="src"><pre><code class="objc">        else {</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">815</td>
<td class="src"><pre><code class="objc">            // This code only gets executed when we insert a message on this device and immediately set the window before the message was updated from the BE</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">816</td>
<td class="src"><pre><code class="objc">            // Since the message was created by the selfUser, we don't want to sync the lastRead</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">817</td>
<td class="src"><pre><code class="objc">            // To stop syncing of previously stored values, we need to reset the tempMaxLastRead to 0</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">818</td>
<td class="src"><pre><code class="objc">            self.tempMaxLastReadServerTimeStamp = nil;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">819</td>
<td class="src"><pre><code class="objc">            self.lastReadEventIDUpdateCounter = 0;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">820</td>
<td class="src"><pre><code class="objc">            return;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">821</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">822</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">823</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">824</td>
<td class="src"><pre><code class="objc">    if (self.managedObjectContext.zm_isUserInterfaceContext) {</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">825</td>
<td class="src"><pre><code class="objc">        self.lastReadEventIDUpdateCounter++;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">826</td>
<td class="src"><pre><code class="objc">        int64_t currentCount = self.lastReadEventIDUpdateCounter;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">827</td>
<td class="src"><pre><code class="objc">        </code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">828</td>
<td class="src"><pre><code class="objc">        [self.managedObjectContext.dispatchGroup enter];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">829</td>
<td class="src"><pre><code class="objc">        ZM_WEAK(self);</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">830</td>
<td class="src"><pre><code class="objc">        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(self.lastReadEventIDSaveDelay * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">831</td>
<td class="src"><pre><code class="objc">            ZM_STRONG(self);</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">832</td>
<td class="src"><pre><code class="objc">            if (self == nil) {</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="missed">
<td class="num">833</td>
<td class="src"><pre><code class="objc">                return;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">834</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">835</td>
<td class="src"><pre><code class="objc">            if (currentCount != self.lastReadEventIDUpdateCounter) {</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">836</td>
<td class="src"><pre><code class="objc">                [self.managedObjectContext.dispatchGroup leave];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">837</td>
<td class="src"><pre><code class="objc">                return;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">838</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">839</td>
<td class="src"><pre><code class="objc">            [self savePendingLastRead];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">840</td>
<td class="src"><pre><code class="objc">            [self.managedObjectContext.dispatchGroup leave];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">841</td>
<td class="src"><pre><code class="objc">        });</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">842</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="missed">
<td class="num">843</td>
<td class="src"><pre><code class="objc">    else {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">844</td>
<td class="src"><pre><code class="objc">        [self updateLastReadServerTimeStampIfNeededWithTimeStamp:self.tempMaxLastReadServerTimeStamp andSync:NO];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">845</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">846</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="never">
<td class="num">847</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">848</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">849</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">850</td>
<td class="src"><pre><code class="objc">- (void)insertUnreadTimeStamp:(NSDate *)serverTimeStamp</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">851</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">852</td>
<td class="src"><pre><code class="objc">    if (serverTimeStamp == nil) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">853</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">854</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">855</td>
<td class="src"><pre><code class="objc">    if ([(NSDate *)self.unreadTimeStamps.firstObject compare:serverTimeStamp] == NSOrderedDescending) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">856</td>
<td class="src"><pre><code class="objc">        [self.unreadTimeStamps addObject:serverTimeStamp];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">857</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">858</td>
<td class="src"><pre><code class="objc">    else if ([(NSDate *)self.unreadTimeStamps.lastObject compare:serverTimeStamp] == NSOrderedAscending) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">859</td>
<td class="src"><pre><code class="objc">        [self.unreadTimeStamps insertObject:serverTimeStamp atIndex:0];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">860</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">861</td>
<td class="src"><pre><code class="objc">    else {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">862</td>
<td class="src"><pre><code class="objc">        NSUInteger index = [self.unreadTimeStamps indexOfObjectPassingTest:^BOOL(NSDate *stamp, NSUInteger idx, BOOL *stop) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">863</td>
<td class="src"><pre><code class="objc">            NOT_USED(idx);</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">864</td>
<td class="src"><pre><code class="objc">            if ([stamp compare:serverTimeStamp] == NSOrderedAscending) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">865</td>
<td class="src"><pre><code class="objc">                *stop = YES;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">866</td>
<td class="src"><pre><code class="objc">                return YES;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">867</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">868</td>
<td class="src"><pre><code class="objc">            return NO;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">869</td>
<td class="src"><pre><code class="objc">        }];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">870</td>
<td class="src"><pre><code class="objc">        [self.unreadTimeStamps insertObject:serverTimeStamp atIndex:index+1];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">871</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">872</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">873</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">874</td>
<td class="src"><pre><code class="objc">- (id &lt;ZMConversationMessage&gt;)appendMessageWithText:(NSString *)text;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">875</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">719x</td>
</tr>
<tr class="covered">
<td class="num">876</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(![text zmHasOnlyWhitespaceCharacters]);</code></pre></td>
<td class="coverage">719x</td>
</tr>
<tr class="covered">
<td class="num">877</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(text != nil);</code></pre></td>
<td class="coverage">717x</td>
</tr>
<tr class="covered">
<td class="num">878</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">717x</td>
</tr>
<tr class="covered">
<td class="num">879</td>
<td class="src"><pre><code class="objc">    NSUUID *nonce = NSUUID.UUID;</code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="covered">
<td class="num">880</td>
<td class="src"><pre><code class="objc">    id &lt;ZMConversationMessage&gt; message = [self appendOTRMessageWithText:text nonce:nonce];</code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="covered">
<td class="num">881</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="covered">
<td class="num">882</td>
<td class="src"><pre><code class="objc">    [[NSNotificationCenter defaultCenter] postNotificationName:ZMConversationClearTypingNotificationName object:self];</code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="covered">
<td class="num">883</td>
<td class="src"><pre><code class="objc">    return message;</code></pre></td>
<td class="coverage">715x</td>
</tr>
<tr class="covered">
<td class="num">884</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">717x</td>
</tr>
<tr class="never">
<td class="num">885</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">886</td>
<td class="src"><pre><code class="objc">- (id&lt;ZMConversationMessage&gt;)appendMessageWithImageAtURL:(NSURL *)fileURL;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">887</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">888</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(fileURL != nil);</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">889</td>
<td class="src"><pre><code class="objc">    if (! fileURL.isFileURL) {</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">890</td>
<td class="src"><pre><code class="objc">        ZMLogWarn(@"Trying to add an image message, but the URL is not a file URL.");</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">891</td>
<td class="src"><pre><code class="objc">        return nil;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">892</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">893</td>
<td class="src"><pre><code class="objc">    NSError *error;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">894</td>
<td class="src"><pre><code class="objc">    // We specifically do not want the data to be mapped at this place, because the underlying file might go away before we're done using the data.</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">895</td>
<td class="src"><pre><code class="objc">    NSData * const originalImageData = [NSData dataWithContentsOfURL:fileURL options:0 error:&amp;error];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">896</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(originalImageData != nil);</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">897</td>
<td class="src"><pre><code class="objc">    CGSize const originalSize = [ZMImagePreprocessor sizeOfPrerotatedImageAtURL:fileURL];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">898</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(! CGSizeEqualToSize(originalSize, CGSizeZero));</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">899</td>
<td class="src"><pre><code class="objc">    return [self appendMessageWithOriginalImageData:originalImageData originalSize:originalSize];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">900</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="never">
<td class="num">901</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">902</td>
<td class="src"><pre><code class="objc">- (id&lt;ZMConversationMessage&gt;)appendMessageWithImageData:(NSData *)imageData;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">903</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">11x</td>
</tr>
<tr class="covered">
<td class="num">904</td>
<td class="src"><pre><code class="objc">    imageData = [imageData copy];</code></pre></td>
<td class="coverage">11x</td>
</tr>
<tr class="covered">
<td class="num">905</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(imageData != nil);</code></pre></td>
<td class="coverage">11x</td>
</tr>
<tr class="covered">
<td class="num">906</td>
<td class="src"><pre><code class="objc">    CGSize const originalSize = [ZMImagePreprocessor sizeOfPrerotatedImageWithData:imageData];</code></pre></td>
<td class="coverage">11x</td>
</tr>
<tr class="covered">
<td class="num">907</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(! CGSizeEqualToSize(originalSize, CGSizeZero));</code></pre></td>
<td class="coverage">11x</td>
</tr>
<tr class="covered">
<td class="num">908</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">11x</td>
</tr>
<tr class="covered">
<td class="num">909</td>
<td class="src"><pre><code class="objc">    return [self appendMessageWithOriginalImageData:imageData originalSize:originalSize];</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">910</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">11x</td>
</tr>
<tr class="never">
<td class="num">911</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">912</td>
<td class="src"><pre><code class="objc">- (nullable id&lt;ZMConversationMessage&gt;)appendMessageWithFileMetadata:(nonnull ZMFileMetadata *)fileMetadata</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">913</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">914</td>
<td class="src"><pre><code class="objc">    return [self appendOTRMessageWithFileMetadata:fileMetadata nonce:NSUUID.UUID];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">915</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="never">
<td class="num">916</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">917</td>
<td class="src"><pre><code class="objc">- (nullable id&lt;ZMConversationMessage&gt;)appendMessageWithLocationData:(nonnull ZMLocationData *)locationData</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">918</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">919</td>
<td class="src"><pre><code class="objc">    return [self appendOTRMessageWithLocationData:locationData nonce:NSUUID.UUID];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">920</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">921</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">922</td>
<td class="src"><pre><code class="objc">- (id&lt;ZMConversationMessage&gt;)appendMessageWithOriginalImageData:(NSData *)originalImageData originalSize:(CGSize __unused)originalSize;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">923</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">13x</td>
</tr>
<tr class="covered">
<td class="num">924</td>
<td class="src"><pre><code class="objc">    return [self appendOTRMessageWithImageData:originalImageData nonce:[NSUUID UUID]];</code></pre></td>
<td class="coverage">13x</td>
</tr>
<tr class="covered">
<td class="num">925</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">13x</td>
</tr>
<tr class="never">
<td class="num">926</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">927</td>
<td class="src"><pre><code class="objc">- (id&lt;ZMConversationMessage&gt;)appendKnock;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">928</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">929</td>
<td class="src"><pre><code class="objc">    return [self appendOTRKnockMessageWithNonce:[NSUUID UUID]];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">930</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">931</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">932</td>
<td class="src"><pre><code class="objc">- (BOOL)isPendingConnectionConversation;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">933</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">934</td>
<td class="src"><pre><code class="objc">    return self.connection != nil &amp;&amp; self.connection.status == ZMConnectionStatusPending;</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">935</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="never">
<td class="num">936</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">937</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingIsPendingConnectionConversation</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">938</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">939</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObjects:ZMConversationConnectionKey, @"connection.status", nil];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">940</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">941</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">942</td>
<td class="src"><pre><code class="objc">- (ZMConversationListIndicator)conversationListIndicator;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">943</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4200x</td>
</tr>
<tr class="covered">
<td class="num">944</td>
<td class="src"><pre><code class="objc">    if(self.connectedUser.isPendingApprovalByOtherUser) {</code></pre></td>
<td class="coverage">4200x</td>
</tr>
<tr class="covered">
<td class="num">945</td>
<td class="src"><pre><code class="objc">        return ZMConversationListIndicatorPending;</code></pre></td>
<td class="coverage">22x</td>
</tr>
<tr class="covered">
<td class="num">946</td>
<td class="src"><pre><code class="objc">    } else if (self.callDeviceIsActive) {</code></pre></td>
<td class="coverage">4180x</td>
</tr>
<tr class="covered">
<td class="num">947</td>
<td class="src"><pre><code class="objc">            return ZMConversationListIndicatorActiveCall;</code></pre></td>
<td class="coverage">48x</td>
</tr>
<tr class="covered">
<td class="num">948</td>
<td class="src"><pre><code class="objc">    } else if (self.voiceChannelState == ZMVoiceChannelStateIncomingCallInactive) {</code></pre></td>
<td class="coverage">4130x</td>
</tr>
<tr class="missed">
<td class="num">949</td>
<td class="src"><pre><code class="objc">        return ZMConversationListIndicatorInactiveCall;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">950</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">951</td>
<td class="src"><pre><code class="objc">    return [self unreadListIndicator];</code></pre></td>
<td class="coverage">4130x</td>
</tr>
<tr class="covered">
<td class="num">952</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4200x</td>
</tr>
<tr class="never">
<td class="num">953</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">954</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingConversationListIndicator</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">955</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">956</td>
<td class="src"><pre><code class="objc">    return [ZMConversation keyPathsForValuesAffectingUnreadListIndicator];</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">957</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="never">
<td class="num">958</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">959</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">960</td>
<td class="src"><pre><code class="objc">- (BOOL)hasDraftMessageText</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">961</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">962</td>
<td class="src"><pre><code class="objc">    return (0 &lt; self.draftMessageText.length);</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">963</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="never">
<td class="num">964</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">965</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingHasDraftMessageText</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">966</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">967</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObject:DraftMessageTextKey];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">968</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">969</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">970</td>
<td class="src"><pre><code class="objc">- (ZMMessage *)lastReadMessage;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">971</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">661x</td>
</tr>
<tr class="covered">
<td class="num">972</td>
<td class="src"><pre><code class="objc">    NSDate * const timeStamp = self.lastReadServerTimeStamp;</code></pre></td>
<td class="coverage">661x</td>
</tr>
<tr class="covered">
<td class="num">973</td>
<td class="src"><pre><code class="objc">    if (timeStamp == nil ||</code></pre></td>
<td class="coverage">661x</td>
</tr>
<tr class="covered">
<td class="num">974</td>
<td class="src"><pre><code class="objc">        self.messages.count == 0 ||</code></pre></td>
<td class="coverage">638x</td>
</tr>
<tr class="covered">
<td class="num">975</td>
<td class="src"><pre><code class="objc">        [timeStamp compare:[self.messages.firstObject serverTimestamp]] == NSOrderedAscending</code></pre></td>
<td class="coverage">638x</td>
</tr>
<tr class="covered">
<td class="num">976</td>
<td class="src"><pre><code class="objc">        )</code></pre></td>
<td class="coverage">661x</td>
</tr>
<tr class="covered">
<td class="num">977</td>
<td class="src"><pre><code class="objc">    {</code></pre></td>
<td class="coverage">25x</td>
</tr>
<tr class="covered">
<td class="num">978</td>
<td class="src"><pre><code class="objc">        return nil;</code></pre></td>
<td class="coverage">25x</td>
</tr>
<tr class="covered">
<td class="num">979</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">25x</td>
</tr>
<tr class="covered">
<td class="num">980</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">661x</td>
</tr>
<tr class="covered">
<td class="num">981</td>
<td class="src"><pre><code class="objc">    if ([timeStamp compare:[self.messages.lastObject serverTimestamp]] == NSOrderedDescending) {</code></pre></td>
<td class="coverage">636x</td>
</tr>
<tr class="covered">
<td class="num">982</td>
<td class="src"><pre><code class="objc">        return self.messages.lastObject;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">983</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">984</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">636x</td>
</tr>
<tr class="covered">
<td class="num">985</td>
<td class="src"><pre><code class="objc">    BOOL reverseSearch = NO;</code></pre></td>
<td class="coverage">632x</td>
</tr>
<tr class="covered">
<td class="num">986</td>
<td class="src"><pre><code class="objc">    ZMMessage *aMessage = self.messages[self.messages.count/2];</code></pre></td>
<td class="coverage">632x</td>
</tr>
<tr class="covered">
<td class="num">987</td>
<td class="src"><pre><code class="objc">    if ([aMessage.serverTimestamp compare:self.lastReadServerTimeStamp] == NSOrderedAscending) {</code></pre></td>
<td class="coverage">632x</td>
</tr>
<tr class="covered">
<td class="num">988</td>
<td class="src"><pre><code class="objc">        reverseSearch = YES;</code></pre></td>
<td class="coverage">286x</td>
</tr>
<tr class="covered">
<td class="num">989</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">286x</td>
</tr>
<tr class="covered">
<td class="num">990</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">632x</td>
</tr>
<tr class="covered">
<td class="num">991</td>
<td class="src"><pre><code class="objc">    __block ZMMessage *result;</code></pre></td>
<td class="coverage">632x</td>
</tr>
<tr class="covered">
<td class="num">992</td>
<td class="src"><pre><code class="objc">    __block NSDate *resultTimeStamp;</code></pre></td>
<td class="coverage">632x</td>
</tr>
<tr class="covered">
<td class="num">993</td>
<td class="src"><pre><code class="objc">    [self.messages enumerateObjectsWithOptions:reverseSearch ? NSEnumerationReverse : 0</code></pre></td>
<td class="coverage">632x</td>
</tr>
<tr class="never">
<td class="num">994</td>
<td class="src"><pre><code class="objc">                                    usingBlock:^(ZMMessage *message, NSUInteger ZM_UNUSED idx, BOOL *stop) {</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">995</td>
<td class="src"><pre><code class="objc">                                        NSDate *newTimeStamp = [message valueForKey:ZMMessageServerTimestampKey];</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">996</td>
<td class="src"><pre><code class="objc">                                        </code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">997</td>
<td class="src"><pre><code class="objc">                                        if (newTimeStamp == nil) {</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">998</td>
<td class="src"><pre><code class="objc">                                            ZMLogWarn(@"Conversation contains message without a timestamp, all messages should have a timestamp.");</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">999</td>
<td class="src"><pre><code class="objc">                                        } else if ([timeStamp compare:newTimeStamp] == NSOrderedSame) {</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1000</td>
<td class="src"><pre><code class="objc">                                            result = message;</code></pre></td>
<td class="coverage">630x</td>
</tr>
<tr class="covered">
<td class="num">1001</td>
<td class="src"><pre><code class="objc">                                            *stop = YES;</code></pre></td>
<td class="coverage">630x</td>
</tr>
<tr class="never">
<td class="num">1002</td>
<td class="src"><pre><code class="objc">                                        } else if ([timeStamp compare:newTimeStamp] == NSOrderedAscending) {</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1003</td>
<td class="src"><pre><code class="objc">                                            return;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1004</td>
<td class="src"><pre><code class="objc">                                        } else if (resultTimeStamp == nil) {</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1005</td>
<td class="src"><pre><code class="objc">                                            resultTimeStamp = newTimeStamp;</code></pre></td>
<td class="coverage">318x</td>
</tr>
<tr class="covered">
<td class="num">1006</td>
<td class="src"><pre><code class="objc">                                            result = message;</code></pre></td>
<td class="coverage">318x</td>
</tr>
<tr class="never">
<td class="num">1007</td>
<td class="src"><pre><code class="objc">                                        } else if ([resultTimeStamp compare:newTimeStamp] == NSOrderedAscending) {</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1008</td>
<td class="src"><pre><code class="objc">                                            resultTimeStamp = newTimeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1009</td>
<td class="src"><pre><code class="objc">                                            result = message;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1010</td>
<td class="src"><pre><code class="objc">                                        }</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1011</td>
<td class="src"><pre><code class="objc">                                    }];</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1012</td>
<td class="src"><pre><code class="objc">    return result;</code></pre></td>
<td class="coverage">632x</td>
</tr>
<tr class="covered">
<td class="num">1013</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">636x</td>
</tr>
<tr class="never">
<td class="num">1014</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1015</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingLastReadMessage</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1016</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1017</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObjects:ZMConversationMessagesKey, ZMConversationLastReadServerTimeStampKey, nil];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1018</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">1019</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1020</td>
<td class="src"><pre><code class="objc">- (void)updateKeysThatHaveLocalModifications;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1021</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2520x</td>
</tr>
<tr class="covered">
<td class="num">1022</td>
<td class="src"><pre><code class="objc">    [super updateKeysThatHaveLocalModifications];</code></pre></td>
<td class="coverage">2520x</td>
</tr>
<tr class="covered">
<td class="num">1023</td>
<td class="src"><pre><code class="objc">    NSMutableSet *newKeys = [self.keysThatHaveLocalModifications mutableCopy];</code></pre></td>
<td class="coverage">2520x</td>
</tr>
<tr class="covered">
<td class="num">1024</td>
<td class="src"><pre><code class="objc">    if (self.unsyncedInactiveParticipants.count &gt; 0) {</code></pre></td>
<td class="coverage">2520x</td>
</tr>
<tr class="covered">
<td class="num">1025</td>
<td class="src"><pre><code class="objc">        [newKeys addObject:ZMConversationUnsyncedInactiveParticipantsKey];</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1026</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1027</td>
<td class="src"><pre><code class="objc">    if (self.unsyncedActiveParticipants.count &gt; 0) {</code></pre></td>
<td class="coverage">2520x</td>
</tr>
<tr class="covered">
<td class="num">1028</td>
<td class="src"><pre><code class="objc">        [newKeys addObject:ZMConversationUnsyncedActiveParticipantsKey];</code></pre></td>
<td class="coverage">211x</td>
</tr>
<tr class="covered">
<td class="num">1029</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">211x</td>
</tr>
<tr class="covered">
<td class="num">1030</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">2520x</td>
</tr>
<tr class="covered">
<td class="num">1031</td>
<td class="src"><pre><code class="objc">    if( ![newKeys isEqual:self.keysThatHaveLocalModifications]) {</code></pre></td>
<td class="coverage">2520x</td>
</tr>
<tr class="covered">
<td class="num">1032</td>
<td class="src"><pre><code class="objc">        [self setLocallyModifiedKeys:newKeys];</code></pre></td>
<td class="coverage">105x</td>
</tr>
<tr class="covered">
<td class="num">1033</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">105x</td>
</tr>
<tr class="covered">
<td class="num">1034</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2520x</td>
</tr>
<tr class="never">
<td class="num">1035</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1036</td>
<td class="src"><pre><code class="objc">- (NSSet *)keysThatHaveLocalModifications</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1037</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">13000x</td>
</tr>
<tr class="covered">
<td class="num">1038</td>
<td class="src"><pre><code class="objc">    NSMutableSet *keys = [NSMutableSet setWithSet:super.keysThatHaveLocalModifications];</code></pre></td>
<td class="coverage">13000x</td>
</tr>
<tr class="covered">
<td class="num">1039</td>
<td class="src"><pre><code class="objc">    if (!self.isZombieObject) {</code></pre></td>
<td class="coverage">13000x</td>
</tr>
<tr class="covered">
<td class="num">1040</td>
<td class="src"><pre><code class="objc">        if(self.hasLocalModificationsForCallDeviceIsActive) {</code></pre></td>
<td class="coverage">13000x</td>
</tr>
<tr class="covered">
<td class="num">1041</td>
<td class="src"><pre><code class="objc">            [keys addObject:ZMConversationCallDeviceIsActiveKey];</code></pre></td>
<td class="coverage">198x</td>
</tr>
<tr class="covered">
<td class="num">1042</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">198x</td>
</tr>
<tr class="covered">
<td class="num">1043</td>
<td class="src"><pre><code class="objc">        if (self.hasLocalModificationsForIsSendingVideo) {</code></pre></td>
<td class="coverage">13000x</td>
</tr>
<tr class="missed">
<td class="num">1044</td>
<td class="src"><pre><code class="objc">            [keys addObject:ZMConversationIsSendingVideoKey];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1045</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">1046</td>
<td class="src"><pre><code class="objc">        if (self.hasLocalModificationsForIsIgnoringCall) {</code></pre></td>
<td class="coverage">13000x</td>
</tr>
<tr class="covered">
<td class="num">1047</td>
<td class="src"><pre><code class="objc">            [keys addObject:ZMConversationIsIgnoringCallKey];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1048</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1049</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">13000x</td>
</tr>
<tr class="covered">
<td class="num">1050</td>
<td class="src"><pre><code class="objc">    return [keys copy];</code></pre></td>
<td class="coverage">13000x</td>
</tr>
<tr class="covered">
<td class="num">1051</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">13000x</td>
</tr>
<tr class="never">
<td class="num">1052</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1053</td>
<td class="src"><pre><code class="objc">- (void)willSave</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1054</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2750x</td>
</tr>
<tr class="covered">
<td class="num">1055</td>
<td class="src"><pre><code class="objc">    [super willSave];</code></pre></td>
<td class="coverage">2750x</td>
</tr>
<tr class="covered">
<td class="num">1056</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">2750x</td>
</tr>
<tr class="covered">
<td class="num">1057</td>
<td class="src"><pre><code class="objc">    if (self.unsyncedInactiveParticipants.count == 0 &amp;&amp; [self.keysThatHaveLocalModifications containsObject:ZMConversationUnsyncedInactiveParticipantsKey]) {</code></pre></td>
<td class="coverage">2750x</td>
</tr>
<tr class="covered">
<td class="num">1058</td>
<td class="src"><pre><code class="objc">        [self resetLocallyModifiedKeys:[NSSet setWithObject:ZMConversationUnsyncedInactiveParticipantsKey]];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1059</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1060</td>
<td class="src"><pre><code class="objc">    if (self.unsyncedActiveParticipants.count == 0 &amp;&amp; [self.keysThatHaveLocalModifications containsObject:ZMConversationUnsyncedActiveParticipantsKey]) {</code></pre></td>
<td class="coverage">2750x</td>
</tr>
<tr class="covered">
<td class="num">1061</td>
<td class="src"><pre><code class="objc">        [self resetLocallyModifiedKeys:[NSSet setWithObject:ZMConversationUnsyncedActiveParticipantsKey]];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1062</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1063</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2750x</td>
</tr>
<tr class="never">
<td class="num">1064</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1065</td>
<td class="src"><pre><code class="objc">- (NSArray *)keysTrackedForLocalModifications {</code></pre></td>
<td class="coverage">13700x</td>
</tr>
<tr class="covered">
<td class="num">1066</td>
<td class="src"><pre><code class="objc">    NSArray *superKeys = [super keysTrackedForLocalModifications];</code></pre></td>
<td class="coverage">13700x</td>
</tr>
<tr class="covered">
<td class="num">1067</td>
<td class="src"><pre><code class="objc">    NSMutableArray *trackedKeys = [superKeys mutableCopy];</code></pre></td>
<td class="coverage">13700x</td>
</tr>
<tr class="covered">
<td class="num">1068</td>
<td class="src"><pre><code class="objc">    [trackedKeys addObject:ZMConversationUnsyncedInactiveParticipantsKey];</code></pre></td>
<td class="coverage">13700x</td>
</tr>
<tr class="covered">
<td class="num">1069</td>
<td class="src"><pre><code class="objc">    [trackedKeys addObject:ZMConversationUnsyncedActiveParticipantsKey];</code></pre></td>
<td class="coverage">13700x</td>
</tr>
<tr class="covered">
<td class="num">1070</td>
<td class="src"><pre><code class="objc">    [trackedKeys addObject:ZMConversationCallDeviceIsActiveKey];</code></pre></td>
<td class="coverage">13700x</td>
</tr>
<tr class="covered">
<td class="num">1071</td>
<td class="src"><pre><code class="objc">    [trackedKeys addObject:ZMConversationIsSendingVideoKey];</code></pre></td>
<td class="coverage">13700x</td>
</tr>
<tr class="covered">
<td class="num">1072</td>
<td class="src"><pre><code class="objc">    [trackedKeys addObject:ZMConversationIsIgnoringCallKey];</code></pre></td>
<td class="coverage">13700x</td>
</tr>
<tr class="covered">
<td class="num">1073</td>
<td class="src"><pre><code class="objc">    return trackedKeys;</code></pre></td>
<td class="coverage">13700x</td>
</tr>
<tr class="covered">
<td class="num">1074</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">13700x</td>
</tr>
<tr class="never">
<td class="num">1075</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1076</td>
<td class="src"><pre><code class="objc">- (NSMutableOrderedSet *)mutableLastServerSyncedActiveParticipants</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1077</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">10700x</td>
</tr>
<tr class="covered">
<td class="num">1078</td>
<td class="src"><pre><code class="objc">    return [self mutableOrderedSetValueForKey:LastServerSyncedActiveParticipantsKey];</code></pre></td>
<td class="coverage">10700x</td>
</tr>
<tr class="covered">
<td class="num">1079</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">10700x</td>
</tr>
<tr class="never">
<td class="num">1080</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1081</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1082</td>
<td class="src"><pre><code class="objc">- (void)resendLastUnsentMessages</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">1083</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1084</td>
<td class="src"><pre><code class="objc">    [self.messages enumerateObjectsWithOptions:NSEnumerationReverse usingBlock:^(ZMMessage *message, __unused NSUInteger idx, BOOL *stop) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1085</td>
<td class="src"><pre><code class="objc">        if (message.isExpired) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1086</td>
<td class="src"><pre><code class="objc">            [message resend];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1087</td>
<td class="src"><pre><code class="objc">            *stop = YES;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1088</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1089</td>
<td class="src"><pre><code class="objc">    }];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1090</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">1091</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1092</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1093</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1094</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1095</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1096</td>
<td class="src"><pre><code class="objc">@implementation ZMConversation (Internal)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1097</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1098</td>
<td class="src"><pre><code class="objc">@dynamic connection;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1099</td>
<td class="src"><pre><code class="objc">@dynamic creator;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1100</td>
<td class="src"><pre><code class="objc">@dynamic lastModifiedDate;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1101</td>
<td class="src"><pre><code class="objc">@dynamic downloadedMessageIDs;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1102</td>
<td class="src"><pre><code class="objc">@dynamic normalizedUserDefinedName;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1103</td>
<td class="src"><pre><code class="objc">@dynamic callStateNeedsToBeUpdatedFromBackend;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1104</td>
<td class="src"><pre><code class="objc">@dynamic hiddenMessages;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1105</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1106</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1107</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)callConversationPredicate;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1108</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1109</td>
<td class="src"><pre><code class="objc">    return [NSPredicate predicateWithFormat:@"(%K != NULL) AND ((%K == %@) OR (%K == %@))",</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1110</td>
<td class="src"><pre><code class="objc">            [self remoteIdentifierDataKey],</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1111</td>
<td class="src"><pre><code class="objc">            ConversationTypeKey, @(ZMConversationTypeOneOnOne),</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1112</td>
<td class="src"><pre><code class="objc">            ConversationTypeKey, @(ZMConversationTypeGroup)];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1113</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">1114</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1115</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForObjectsThatNeedCallStateToBeUpdatedUpstream;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">1116</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1117</td>
<td class="src"><pre><code class="objc">    NSPredicate *predicate = [NSPredicate predicateWithFormat:@"(%K == 0) AND (%K == 0)",</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1118</td>
<td class="src"><pre><code class="objc">            CallStateNeedsToBeUpdatedFromBackendKey,</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1119</td>
<td class="src"><pre><code class="objc">            NeedsToBeUpdatedFromBackendKey];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1120</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1121</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[predicate, [self callConversationPredicate], [super predicateForObjectsThatNeedToBeUpdatedUpstream]]];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1122</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">1123</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1124</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForUpdatingCallStateDuringSlowSync;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1125</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1126</td>
<td class="src"><pre><code class="objc">    NSPredicate *predicate = [NSPredicate predicateWithFormat:@"(%K == 0) AND (%K.@count &gt; 0)",</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1127</td>
<td class="src"><pre><code class="objc">                              CallStateNeedsToBeUpdatedFromBackendKey,</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1128</td>
<td class="src"><pre><code class="objc">                              ZMConversationCallParticipantsKey];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1129</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1130</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[predicate, [self callConversationPredicate]]];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1131</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">1132</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1133</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForNeedingCallStateToBeUpdatedFromBackend;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">1134</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1135</td>
<td class="src"><pre><code class="objc">    NSPredicate *predicate = [NSPredicate predicateWithFormat:@"(%K == 1)",</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1136</td>
<td class="src"><pre><code class="objc">                              CallStateNeedsToBeUpdatedFromBackendKey];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1137</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1138</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[predicate, [self callConversationPredicate]]];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1139</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">1140</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1141</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1142</td>
<td class="src"><pre><code class="objc">+ (NSSet *)keyPathsForValuesAffectingIsArchived</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1143</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">1144</td>
<td class="src"><pre><code class="objc">    return [NSSet setWithObject:ZMConversationIsArchivedKey];</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="covered">
<td class="num">1145</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2590x</td>
</tr>
<tr class="never">
<td class="num">1146</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1147</td>
<td class="src"><pre><code class="objc">+ (NSString *)entityName;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1148</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4880x</td>
</tr>
<tr class="covered">
<td class="num">1149</td>
<td class="src"><pre><code class="objc">    return @"Conversation";</code></pre></td>
<td class="coverage">4880x</td>
</tr>
<tr class="covered">
<td class="num">1150</td>
<td class="src"><pre><code class="objc">} </code></pre></td>
<td class="coverage">4880x</td>
</tr>
<tr class="never">
<td class="num">1151</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1152</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1153</td>
<td class="src"><pre><code class="objc">- (NSMutableOrderedSet *)mutableMessages;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1154</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">31500x</td>
</tr>
<tr class="covered">
<td class="num">1155</td>
<td class="src"><pre><code class="objc">    return [self mutableOrderedSetValueForKey:ZMConversationMessagesKey];</code></pre></td>
<td class="coverage">31500x</td>
</tr>
<tr class="covered">
<td class="num">1156</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">31500x</td>
</tr>
<tr class="never">
<td class="num">1157</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1158</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForValidConversations;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1159</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1160</td>
<td class="src"><pre><code class="objc">    NSPredicate *basePredicate = [self predicateForFilteringResults];</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1161</td>
<td class="src"><pre><code class="objc">    NSPredicate *notAConnection = [NSPredicate predicateWithFormat:@"%K != %d", ConversationTypeKey, ZMConversationTypeConnection]; //one-to-one conversations</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1162</td>
<td class="src"><pre><code class="objc">    NSPredicate *activeConnection = [NSPredicate predicateWithFormat:@"NOT %K.status IN %@", ZMConversationConnectionKey, @[@(ZMConnectionStatusPending), @(ZMConnectionStatusIgnored), @(ZMConnectionStatusCancelled)]]; //pending connections should be in other list, ignored and cancelled are not displayed</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1163</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1164</td>
<td class="src"><pre><code class="objc">    NSPredicate *predicate1 = [NSCompoundPredicate orPredicateWithSubpredicates:@[notAConnection, activeConnection]]; // one-to-one conversations and not pending and not ignored connections</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1165</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1166</td>
<td class="src"><pre><code class="objc">    NSPredicate *noConnection = [NSPredicate predicateWithFormat:@"%K == nil", ZMConversationConnectionKey]; //group conversations</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1167</td>
<td class="src"><pre><code class="objc">    NSPredicate *notBlocked = [NSPredicate predicateWithFormat:@"%K.status != %d",</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1168</td>
<td class="src"><pre><code class="objc">                               ZMConversationConnectionKey, ZMConnectionStatusBlocked];</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1169</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1170</td>
<td class="src"><pre><code class="objc">    NSPredicate *predicate2 = [NSCompoundPredicate orPredicateWithSubpredicates:@[noConnection, notBlocked]]; //group conversations and not blocked connections</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1171</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[basePredicate, predicate1, predicate2]];</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="covered">
<td class="num">1172</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">280x</td>
</tr>
<tr class="never">
<td class="num">1173</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1174</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForConversationsIncludingArchived;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1175</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1176</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1177</td>
<td class="src"><pre><code class="objc">    NSPredicate *notClearedTimeStamp = [NSPredicate predicateWithFormat:@"%K == NULL OR %K &gt; %K OR (%K == %K AND %K == NO)",</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1178</td>
<td class="src"><pre><code class="objc">                                        ZMConversationClearedTimeStampKey,</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1179</td>
<td class="src"><pre><code class="objc">                                        ZMConversationLastServerTimeStampKey, ZMConversationClearedTimeStampKey,</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1180</td>
<td class="src"><pre><code class="objc">                                        ZMConversationLastServerTimeStampKey, ZMConversationClearedTimeStampKey,</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1181</td>
<td class="src"><pre><code class="objc">                                        ZMConversationIsArchivedKey];</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1182</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1183</td>
<td class="src"><pre><code class="objc">    NSPredicate *notClearedEventID = [NSPredicate predicateWithFormat:@"%K == NULL OR %K &gt; %K OR (%K == %K AND %K == NO)",</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1184</td>
<td class="src"><pre><code class="objc">                                      ZMConversationClearedEventIDDataKey,</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1185</td>
<td class="src"><pre><code class="objc">                                      LastEventIDDataKey, ZMConversationClearedEventIDDataKey,</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1186</td>
<td class="src"><pre><code class="objc">                                      LastEventIDDataKey, ZMConversationClearedEventIDDataKey,</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1187</td>
<td class="src"><pre><code class="objc">                                      ZMConversationIsArchivedKey];</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1188</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1189</td>
<td class="src"><pre><code class="objc">    NSPredicate *notCleared = [NSCompoundPredicate andPredicateWithSubpredicates:@[notClearedTimeStamp, notClearedEventID]];</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1190</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1191</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[notCleared, [self predicateForValidConversations]]];</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="covered">
<td class="num">1192</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">214x</td>
</tr>
<tr class="never">
<td class="num">1193</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1194</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForArchivedConversations;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1195</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1196</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1197</td>
<td class="src"><pre><code class="objc">                                                                [self predicateForConversationsIncludingArchived],</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1198</td>
<td class="src"><pre><code class="objc">                                                                [NSPredicate predicateWithFormat:@"%K == YES", ZMConversationIsArchivedKey]</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1199</td>
<td class="src"><pre><code class="objc">                                                                ]];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1200</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="never">
<td class="num">1201</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1202</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForClearedConversations</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1203</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1204</td>
<td class="src"><pre><code class="objc">    NSPredicate *cleared = [NSPredicate predicateWithFormat:@"(%K != NULL OR %K != NULL) AND %K == YES",</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1205</td>
<td class="src"><pre><code class="objc">                                ZMConversationClearedTimeStampKey,</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1206</td>
<td class="src"><pre><code class="objc">                                ZMConversationClearedEventIDKey,</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1207</td>
<td class="src"><pre><code class="objc">                                ZMConversationIsArchivedKey];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1208</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1209</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[cleared, [self predicateForValidConversations]]];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1210</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="never">
<td class="num">1211</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1212</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForConversationsExcludingArchivedAndInCall;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1213</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1214</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1215</td>
<td class="src"><pre><code class="objc">                                                                [self predicateForConversationsIncludingArchived],</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1216</td>
<td class="src"><pre><code class="objc">                                                                [NSPredicate predicateWithFormat:@"%K == NO AND %K != %d",</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1217</td>
<td class="src"><pre><code class="objc">                                                                 ZMConversationIsArchivedKey,</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1218</td>
<td class="src"><pre><code class="objc">                                                                 VoiceChannelStateKey, ZMVoiceChannelStateSelfConnectedToActiveChannel]</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1219</td>
<td class="src"><pre><code class="objc">                                                                ]];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1220</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="never">
<td class="num">1221</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1222</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForPendingConversations;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1223</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1224</td>
<td class="src"><pre><code class="objc">    NSPredicate *basePredicate = [self predicateForFilteringResults];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1225</td>
<td class="src"><pre><code class="objc">    NSPredicate *pendingConversationPredicate = [NSPredicate predicateWithFormat:@"%K == %d AND %K.status == %d",</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1226</td>
<td class="src"><pre><code class="objc">                                     ConversationTypeKey, ZMConversationTypeConnection,</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1227</td>
<td class="src"><pre><code class="objc">                                     ZMConversationConnectionKey, ZMConnectionStatusPending];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1228</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1229</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[basePredicate, pendingConversationPredicate]];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1230</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="never">
<td class="num">1231</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1232</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForConversationsWithNonIdleVoiceChannel;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1233</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1234</td>
<td class="src"><pre><code class="objc">    NSPredicate *basePredicate = [self predicateForFilteringResults];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1235</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1236</td>
<td class="src"><pre><code class="objc">    NSPredicate *callingPredicate = [NSPredicate predicateWithFormat:@"%K != %d AND %K != %d",</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1237</td>
<td class="src"><pre><code class="objc">                                     VoiceChannelStateKey, ZMVoiceChannelStateNoActiveUsers,</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1238</td>
<td class="src"><pre><code class="objc">                                     ConversationTypeKey, ZMConversationTypeConnection];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1239</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1240</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[basePredicate, callingPredicate]];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1241</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="never">
<td class="num">1242</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1243</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForConversationWithActiveCalls;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1244</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1245</td>
<td class="src"><pre><code class="objc">    NSPredicate *basePredicate = [self predicateForFilteringResults];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1246</td>
<td class="src"><pre><code class="objc">    NSPredicate *callingPredicate = [NSPredicate predicateWithFormat:@"%K == %d", VoiceChannelStateKey, ZMVoiceChannelStateSelfConnectedToActiveChannel];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1247</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1248</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[basePredicate, callingPredicate]];</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="covered">
<td class="num">1249</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">66x</td>
</tr>
<tr class="never">
<td class="num">1250</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1251</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForSharableConversations</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1252</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1253</td>
<td class="src"><pre><code class="objc">    NSPredicate *basePredication = [self predicateForConversationsIncludingArchived];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1254</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1255</td>
<td class="src"><pre><code class="objc">    NSPredicate *hasOtherActiveParticipants = [NSPredicate predicateWithFormat:@"%K.@count &gt; 0", ZMConversationOtherActiveParticipantsKey];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1256</td>
<td class="src"><pre><code class="objc">    NSPredicate *oneOnOneOrGroupConversation = [NSPredicate predicateWithFormat:@"%K == %i OR %K == %i",</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1257</td>
<td class="src"><pre><code class="objc">                                                ZMConversationConversationTypeKey, ZMConversationTypeOneOnOne,</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1258</td>
<td class="src"><pre><code class="objc">                                                ZMConversationConversationTypeKey, ZMConversationTypeGroup];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1259</td>
<td class="src"><pre><code class="objc">    NSPredicate *selfIsActiveMember = [NSPredicate predicateWithFormat:@"isSelfAnActiveMember == YES"];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1260</td>
<td class="src"><pre><code class="objc">    NSPredicate *synced = [NSPredicate predicateWithFormat:@"%K != NULL", [self remoteIdentifierDataKey]];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1261</td>
<td class="src"><pre><code class="objc">    return [NSCompoundPredicate andPredicateWithSubpredicates:@[basePredication, oneOnOneOrGroupConversation, hasOtherActiveParticipants, selfIsActiveMember, synced]];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1262</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">1263</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1264</td>
<td class="src"><pre><code class="objc">+ (ZMConversationList *)conversationsIncludingArchivedInContext:(NSManagedObjectContext *)moc;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1265</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">1266</td>
<td class="src"><pre><code class="objc">    return [moc.conversationListDirectory conversationsIncludingArchived];</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">1267</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="never">
<td class="num">1268</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1269</td>
<td class="src"><pre><code class="objc">+ (ZMConversationList *)archivedConversationsInContext:(NSManagedObjectContext *)moc;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1270</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="covered">
<td class="num">1271</td>
<td class="src"><pre><code class="objc">    return [moc.conversationListDirectory archivedConversations];</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="covered">
<td class="num">1272</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="never">
<td class="num">1273</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1274</td>
<td class="src"><pre><code class="objc">+ (ZMConversationList *)clearedConversationsInContext:(NSManagedObjectContext *)moc;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1275</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1276</td>
<td class="src"><pre><code class="objc">    return [moc.conversationListDirectory clearedConversations];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1277</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">1278</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1279</td>
<td class="src"><pre><code class="objc">+ (ZMConversationList *)conversationsExcludingArchivedAndCallingInContext:(NSManagedObjectContext *)moc;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1280</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1281</td>
<td class="src"><pre><code class="objc">    return [moc.conversationListDirectory unarchivedAndNotCallingConversations];</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1282</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="never">
<td class="num">1283</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1284</td>
<td class="src"><pre><code class="objc">+ (ZMConversationList *)pendingConversationsInContext:(NSManagedObjectContext *)moc;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1285</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1286</td>
<td class="src"><pre><code class="objc">    return [moc.conversationListDirectory pendingConnectionConversations];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1287</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">1288</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1289</td>
<td class="src"><pre><code class="objc">- (void)sortMessages</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1290</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1291</td>
<td class="src"><pre><code class="objc">    NSOrderedSet *sorted = [NSOrderedSet orderedSetWithArray:[self.messages sortedArrayUsingDescriptors:[ZMMessage defaultSortDescriptors]]];</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1292</td>
<td class="src"><pre><code class="objc">    // Be sure not to "dirty" the relationship, unless we need to:</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1293</td>
<td class="src"><pre><code class="objc">    if (! [self.messages isEqualToOrderedSet:sorted]) {</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1294</td>
<td class="src"><pre><code class="objc">        [self setValue:sorted forKey:ZMConversationMessagesKey];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1295</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1296</td>
<td class="src"><pre><code class="objc">    // sortMessages is called when processing downloaded events (e.g. after slow sync) which can be unordered</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1297</td>
<td class="src"><pre><code class="objc">    // after sorting messages we also need to recalculate the unread properties</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1298</td>
<td class="src"><pre><code class="objc">    [self didUpdateConversationWhileFetchingUnreadMessages];</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="covered">
<td class="num">1299</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">24x</td>
</tr>
<tr class="never">
<td class="num">1300</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1301</td>
<td class="src"><pre><code class="objc">- (void)resortMessagesWithUpdatedMessage:(ZMMessage *)message</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1302</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">1303</td>
<td class="src"><pre><code class="objc">    [self.mutableMessages removeObject:message];</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">1304</td>
<td class="src"><pre><code class="objc">    [self sortedAppendMessage:message];</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">1305</td>
<td class="src"><pre><code class="objc">    [self updateUnreadCountIfNeededForMessage:message];</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">1306</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="never">
<td class="num">1307</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1308</td>
<td class="src"><pre><code class="objc">- (void)updateUnreadCountIfNeededForMessage:(ZMMessage *)message</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1309</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">1310</td>
<td class="src"><pre><code class="objc">    BOOL senderIsNotSelf = (message.sender != [ZMUser selfUserInContext:self.managedObjectContext]);</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">1311</td>
<td class="src"><pre><code class="objc">    if (senderIsNotSelf &amp;&amp; [message shouldGenerateUnreadCount]) {</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="covered">
<td class="num">1312</td>
<td class="src"><pre><code class="objc">        [self insertTimeStamp:message.serverTimestamp];</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">1313</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">1314</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">57x</td>
</tr>
<tr class="never">
<td class="num">1315</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1316</td>
<td class="src"><pre><code class="objc">- (void)resetParticipantsBackToLastServerSync</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1317</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1318</td>
<td class="src"><pre><code class="objc">    [self.mutableOtherActiveParticipants removeAllObjects];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1319</td>
<td class="src"><pre><code class="objc">    [self.mutableOtherActiveParticipants addObjectsFromArray:self.mutableLastServerSyncedActiveParticipants.array];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1320</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1321</td>
<td class="src"><pre><code class="objc">    [self resetLocallyModifiedKeys:[NSSet setWithObject:ZMConversationUnsyncedActiveParticipantsKey]];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1322</td>
<td class="src"><pre><code class="objc">    [self resetLocallyModifiedKeys:[NSSet setWithObject:ZMConversationUnsyncedInactiveParticipantsKey]];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1323</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">1324</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1325</td>
<td class="src"><pre><code class="objc">- (void)mergeWithExistingConversationWithRemoteID:(NSUUID *)remoteID;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">1326</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1327</td>
<td class="src"><pre><code class="objc">    ZMConversation *existingConversation = [ZMConversation conversationWithRemoteID:remoteID createIfNeeded:NO inContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1328</td>
<td class="src"><pre><code class="objc">    if ((existingConversation != nil) &amp;&amp; ![existingConversation isEqual:self]) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1329</td>
<td class="src"><pre><code class="objc">        Require(self.remoteIdentifier == nil);</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1330</td>
<td class="src"><pre><code class="objc">        [self.mutableMessages addObjectsFromArray:existingConversation.messages.array];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1331</td>
<td class="src"><pre><code class="objc">        [self sortMessages];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1332</td>
<td class="src"><pre><code class="objc">        // Just to be on the safe side, force update:</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1333</td>
<td class="src"><pre><code class="objc">        self.needsToBeUpdatedFromBackend = YES;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1334</td>
<td class="src"><pre><code class="objc">        // This is a duplicate. Delete the other one</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1335</td>
<td class="src"><pre><code class="objc">        [self.managedObjectContext deleteObject:existingConversation];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1336</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1337</td>
<td class="src"><pre><code class="objc">    self.remoteIdentifier = remoteID;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1338</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">1339</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1340</td>
<td class="src"><pre><code class="objc">- (void)updateWithMessage:(ZMMessage *)message timeStamp:(NSDate *)timeStamp eventID:(ZMEventID *)eventID</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1341</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1342</td>
<td class="src"><pre><code class="objc">    [self updateLastServerTimeStampIfNeeded:timeStamp];</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1343</td>
<td class="src"><pre><code class="objc">    [self updateLastEventIDIfNeededWithEventID:eventID];</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1344</td>
<td class="src"><pre><code class="objc">    [self addEventToDownloadedEvents:eventID timeStamp:timeStamp];</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1345</td>
<td class="src"><pre><code class="objc">    [self updateLastModifiedDateIfNeeded:timeStamp];</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1346</td>
<td class="src"><pre><code class="objc">    [self updateUnreadMessagesWithMessage:message];</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1347</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="never">
<td class="num">1348</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1349</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1350</td>
<td class="src"><pre><code class="objc">+ (instancetype)conversationWithRemoteID:(NSUUID *)UUID createIfNeeded:(BOOL)create inContext:(NSManagedObjectContext *)moc</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1351</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1352</td>
<td class="src"><pre><code class="objc">    return [self conversationWithRemoteID:UUID createIfNeeded:create inContext:moc created:NULL];</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1353</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="never">
<td class="num">1354</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1355</td>
<td class="src"><pre><code class="objc">+ (instancetype)conversationWithRemoteID:(NSUUID *)UUID createIfNeeded:(BOOL)create inContext:(NSManagedObjectContext *)moc created:(BOOL *)created</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1356</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1357</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(UUID != nil);</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1358</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1359</td>
<td class="src"><pre><code class="objc">    // We must only ever call this on the sync context. Otherwise, there's a race condition</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1360</td>
<td class="src"><pre><code class="objc">    // where the UI and sync contexts could both insert the same conversation (same UUID) and we'd end up</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1361</td>
<td class="src"><pre><code class="objc">    // having two duplicates of that conversation, and we'd have a really hard time recovering from that.</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1362</td>
<td class="src"><pre><code class="objc">    //</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1363</td>
<td class="src"><pre><code class="objc">    RequireString(! create || moc.zm_isSyncContext, "Race condition!");</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1364</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1365</td>
<td class="src"><pre><code class="objc">    ZMConversation *result = [self fetchObjectWithRemoteIdentifier:UUID inManagedObjectContext:moc];</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1366</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1367</td>
<td class="src"><pre><code class="objc">    if (result != nil) {</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1368</td>
<td class="src"><pre><code class="objc">        if (nil != created) {</code></pre></td>
<td class="coverage">137x</td>
</tr>
<tr class="missed">
<td class="num">1369</td>
<td class="src"><pre><code class="objc">            *created = NO;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1370</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">1371</td>
<td class="src"><pre><code class="objc">        return result;</code></pre></td>
<td class="coverage">137x</td>
</tr>
<tr class="covered">
<td class="num">1372</td>
<td class="src"><pre><code class="objc">    } else if (create) {</code></pre></td>
<td class="coverage">28x</td>
</tr>
<tr class="covered">
<td class="num">1373</td>
<td class="src"><pre><code class="objc">        ZMConversation *conversation = [ZMConversation insertNewObjectInManagedObjectContext:moc];</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">1374</td>
<td class="src"><pre><code class="objc">        conversation.remoteIdentifier = UUID;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">1375</td>
<td class="src"><pre><code class="objc">        if (nil != created) {</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="missed">
<td class="num">1376</td>
<td class="src"><pre><code class="objc">            *created = YES;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1377</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">1378</td>
<td class="src"><pre><code class="objc">        return conversation;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">1379</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">1380</td>
<td class="src"><pre><code class="objc">    return nil;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1381</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="never">
<td class="num">1382</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1383</td>
<td class="src"><pre><code class="objc">+ (instancetype)insertGroupConversationIntoManagedObjectContext:(NSManagedObjectContext *)moc withParticipants:(NSArray *)participants;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1384</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1385</td>
<td class="src"><pre><code class="objc">    RequireString((participants.count &gt;= 2u), "Not enough users to create group conversations");</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1386</td>
<td class="src"><pre><code class="objc">    ZMUser *selfUser = [ZMUser selfUserInContext:moc];</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1387</td>
<td class="src"><pre><code class="objc">    ZMConversation *conversation = (ZMConversation *)[super insertNewObjectInManagedObjectContext:moc];</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1388</td>
<td class="src"><pre><code class="objc">    conversation.lastModifiedDate = [NSDate date];</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1389</td>
<td class="src"><pre><code class="objc">    conversation.conversationType = ZMConversationTypeGroup;</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1390</td>
<td class="src"><pre><code class="objc">    conversation.creator = selfUser;</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1391</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1392</td>
<td class="src"><pre><code class="objc">    for (ZMUser *participant in participants) {</code></pre></td>
<td class="coverage">463x</td>
</tr>
<tr class="covered">
<td class="num">1393</td>
<td class="src"><pre><code class="objc">        Require([participant isKindOfClass:[ZMUser class]]);</code></pre></td>
<td class="coverage">463x</td>
</tr>
<tr class="covered">
<td class="num">1394</td>
<td class="src"><pre><code class="objc">        const BOOL isSelf = (participant == selfUser);</code></pre></td>
<td class="coverage">463x</td>
</tr>
<tr class="covered">
<td class="num">1395</td>
<td class="src"><pre><code class="objc">        RequireString(!isSelf, "Can't pass self user as a participant of a group conversation");</code></pre></td>
<td class="coverage">463x</td>
</tr>
<tr class="covered">
<td class="num">1396</td>
<td class="src"><pre><code class="objc">        if(!isSelf) {</code></pre></td>
<td class="coverage">463x</td>
</tr>
<tr class="covered">
<td class="num">1397</td>
<td class="src"><pre><code class="objc">            [conversation internalAddParticipant:participant isAuthoritative:NO];</code></pre></td>
<td class="coverage">463x</td>
</tr>
<tr class="covered">
<td class="num">1398</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">463x</td>
</tr>
<tr class="covered">
<td class="num">1399</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">463x</td>
</tr>
<tr class="covered">
<td class="num">1400</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1401</td>
<td class="src"><pre><code class="objc">    NSMutableSet *allClients = [NSMutableSet set];</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1402</td>
<td class="src"><pre><code class="objc">    for (ZMUser *user in conversation.activeParticipants) {</code></pre></td>
<td class="coverage">628x</td>
</tr>
<tr class="covered">
<td class="num">1403</td>
<td class="src"><pre><code class="objc">        [allClients unionSet:user.clients];</code></pre></td>
<td class="coverage">628x</td>
</tr>
<tr class="covered">
<td class="num">1404</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">628x</td>
</tr>
<tr class="covered">
<td class="num">1405</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1406</td>
<td class="src"><pre><code class="objc">    // We need to check if we should add a 'secure' system message in case all participants are trusted</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1407</td>
<td class="src"><pre><code class="objc">    [conversation increaseSecurityLevelIfNeededAfterUserClientsWereTrusted:allClients];</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1408</td>
<td class="src"><pre><code class="objc">    [conversation appendNewConversationSystemMessageIfNeeded];</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1409</td>
<td class="src"><pre><code class="objc">    return conversation;</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="covered">
<td class="num">1410</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">165x</td>
</tr>
<tr class="never">
<td class="num">1411</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1412</td>
<td class="src"><pre><code class="objc">- (ZMEventIDRangeSet *)downloadedMessageIDs;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1413</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">971x</td>
</tr>
<tr class="covered">
<td class="num">1414</td>
<td class="src"><pre><code class="objc">    NSString *key = DownloadedMessageIDsKey;</code></pre></td>
<td class="coverage">971x</td>
</tr>
<tr class="covered">
<td class="num">1415</td>
<td class="src"><pre><code class="objc">    [self willAccessValueForKey:key];</code></pre></td>
<td class="coverage">971x</td>
</tr>
<tr class="covered">
<td class="num">1416</td>
<td class="src"><pre><code class="objc">    ZMEventIDRangeSet *eventSet = [self primitiveValueForKey:key];</code></pre></td>
<td class="coverage">971x</td>
</tr>
<tr class="covered">
<td class="num">1417</td>
<td class="src"><pre><code class="objc">    [self didAccessValueForKey:key];</code></pre></td>
<td class="coverage">971x</td>
</tr>
<tr class="covered">
<td class="num">1418</td>
<td class="src"><pre><code class="objc">    if (eventSet == nil) {</code></pre></td>
<td class="coverage">971x</td>
</tr>
<tr class="covered">
<td class="num">1419</td>
<td class="src"><pre><code class="objc">        NSData *eventSetData = [self valueForKey:DownloadedMessageIDsDataKey];</code></pre></td>
<td class="coverage">360x</td>
</tr>
<tr class="covered">
<td class="num">1420</td>
<td class="src"><pre><code class="objc">        if (eventSetData != nil) {</code></pre></td>
<td class="coverage">360x</td>
</tr>
<tr class="missed">
<td class="num">1421</td>
<td class="src"><pre><code class="objc">            eventSet = [[ZMEventIDRangeSet alloc] initWithData:eventSetData];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1422</td>
<td class="src"><pre><code class="objc">            [self setPrimitiveValue:eventSet forKey:key];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1423</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">1424</td>
<td class="src"><pre><code class="objc">        else {</code></pre></td>
<td class="coverage">360x</td>
</tr>
<tr class="covered">
<td class="num">1425</td>
<td class="src"><pre><code class="objc">            eventSet = [[ZMEventIDRangeSet alloc] init];</code></pre></td>
<td class="coverage">360x</td>
</tr>
<tr class="covered">
<td class="num">1426</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">360x</td>
</tr>
<tr class="covered">
<td class="num">1427</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">360x</td>
</tr>
<tr class="covered">
<td class="num">1428</td>
<td class="src"><pre><code class="objc">    return eventSet;</code></pre></td>
<td class="coverage">971x</td>
</tr>
<tr class="covered">
<td class="num">1429</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">971x</td>
</tr>
<tr class="never">
<td class="num">1430</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1431</td>
<td class="src"><pre><code class="objc">- (void)setDownloadedMessageIDs:(ZMEventIDRangeSet *)localMessages;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1432</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">502x</td>
</tr>
<tr class="covered">
<td class="num">1433</td>
<td class="src"><pre><code class="objc">    NSString *key = DownloadedMessageIDsKey;</code></pre></td>
<td class="coverage">502x</td>
</tr>
<tr class="covered">
<td class="num">1434</td>
<td class="src"><pre><code class="objc">    [self willChangeValueForKey:key];</code></pre></td>
<td class="coverage">502x</td>
</tr>
<tr class="covered">
<td class="num">1435</td>
<td class="src"><pre><code class="objc">    [self setPrimitiveValue:localMessages forKey:key];</code></pre></td>
<td class="coverage">502x</td>
</tr>
<tr class="covered">
<td class="num">1436</td>
<td class="src"><pre><code class="objc">    [self didChangeValueForKey:key];</code></pre></td>
<td class="coverage">502x</td>
</tr>
<tr class="covered">
<td class="num">1437</td>
<td class="src"><pre><code class="objc">    if (localMessages != nil) {</code></pre></td>
<td class="coverage">502x</td>
</tr>
<tr class="covered">
<td class="num">1438</td>
<td class="src"><pre><code class="objc">        NSData *data = [localMessages serializeToData];</code></pre></td>
<td class="coverage">502x</td>
</tr>
<tr class="covered">
<td class="num">1439</td>
<td class="src"><pre><code class="objc">        [self setValue:data forKeyPath:DownloadedMessageIDsDataKey];</code></pre></td>
<td class="coverage">502x</td>
</tr>
<tr class="missed">
<td class="num">1440</td>
<td class="src"><pre><code class="objc">    } else {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1441</td>
<td class="src"><pre><code class="objc">        [self setValue:[[ZMEventIDRangeSet alloc] init] forKeyPath:DownloadedMessageIDsDataKey];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1442</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">1443</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">502x</td>
</tr>
<tr class="never">
<td class="num">1444</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1445</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)predicateForSearchString:(NSString *)searchString</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1446</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1447</td>
<td class="src"><pre><code class="objc">    NSDictionary *formatDict = @{ZMConversationOtherActiveParticipantsKey : @"ANY %K.normalizedName MATCHES %@",</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1448</td>
<td class="src"><pre><code class="objc">                                   ZMNormalizedUserDefinedNameKey: @"%K MATCHES %@"};</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1449</td>
<td class="src"><pre><code class="objc">    NSPredicate *searchPredicate = [NSPredicate predicateWithFormatDictionary:formatDict</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1450</td>
<td class="src"><pre><code class="objc">                                                         matchingSearchString:searchString];</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1451</td>
<td class="src"><pre><code class="objc">    NSPredicate *activeMemberPredicate = [NSPredicate predicateWithFormat:@"%K == NULL OR %K == YES",</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1452</td>
<td class="src"><pre><code class="objc">                                          ZMConversationClearedTimeStampKey,</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1453</td>
<td class="src"><pre><code class="objc">                                          ZMConversationIsSelfAnActiveMemberKey];</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1454</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1455</td>
<td class="src"><pre><code class="objc">    NSPredicate *basePredicate = [NSPredicate predicateWithFormat:@"(%K == %@)",</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1456</td>
<td class="src"><pre><code class="objc">                                  ConversationTypeKey, @(ZMConversationTypeGroup)];</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1457</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1458</td>
<td class="src"><pre><code class="objc">    NSPredicate *fullPredicate = [NSCompoundPredicate andPredicateWithSubpredicates:@[basePredicate, searchPredicate,activeMemberPredicate]];</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1459</td>
<td class="src"><pre><code class="objc">    return fullPredicate;</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1460</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="never">
<td class="num">1461</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1462</td>
<td class="src"><pre><code class="objc">+ (NSPredicate *)userDefinedNamePredicateForSearchString:(NSString *)searchString;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1463</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">1464</td>
<td class="src"><pre><code class="objc">    NSPredicate *predicate = [NSPredicate predicateWithFormatDictionary:@{ZMNormalizedUserDefinedNameKey: @"%K MATCHES %@"}</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">1465</td>
<td class="src"><pre><code class="objc">                                                   matchingSearchString:searchString];</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">1466</td>
<td class="src"><pre><code class="objc">    return predicate;</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="covered">
<td class="num">1467</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">8x</td>
</tr>
<tr class="never">
<td class="num">1468</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1469</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1470</td>
<td class="src"><pre><code class="objc">+ (NSUUID *)selfConversationIdentifierInContext:(NSManagedObjectContext *)context;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1471</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">1472</td>
<td class="src"><pre><code class="objc">    // remoteID of self-conversation is guaranteed to be the same as remoteID of self-user</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">1473</td>
<td class="src"><pre><code class="objc">    ZMUser *selfUser = [ZMUser selfUserInContext:context];</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">1474</td>
<td class="src"><pre><code class="objc">    return selfUser.remoteIdentifier;</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="covered">
<td class="num">1475</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">15x</td>
</tr>
<tr class="never">
<td class="num">1476</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1477</td>
<td class="src"><pre><code class="objc">+ (ZMConversation *)selfConversationInContext:(NSManagedObjectContext *)managedObjectContext</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1478</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1479</td>
<td class="src"><pre><code class="objc">    NSUUID *selfUserID = [ZMConversation selfConversationIdentifierInContext:managedObjectContext];</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1480</td>
<td class="src"><pre><code class="objc">    return [ZMConversation conversationWithRemoteID:selfUserID createIfNeeded:NO inContext:managedObjectContext];</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1481</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="never">
<td class="num">1482</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1483</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1484</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1485</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1486</td>
<td class="src"><pre><code class="objc">- (void)startFetchingMessages</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1487</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">34x</td>
</tr>
<tr class="covered">
<td class="num">1488</td>
<td class="src"><pre><code class="objc">    [[NSNotificationCenter defaultCenter] postNotificationName:ZMConversationRequestToLoadConversationEventsNotification object:self userInfo:nil];</code></pre></td>
<td class="coverage">34x</td>
</tr>
<tr class="covered">
<td class="num">1489</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">34x</td>
</tr>
<tr class="never">
<td class="num">1490</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1491</td>
<td class="src"><pre><code class="objc">- (ZMClientMessage *)appendNonExpiringGenericMessage:(ZMGenericMessage *)genericMessage hidden:(BOOL)hidden</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1492</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1493</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(genericMessage != nil);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1494</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1495</td>
<td class="src"><pre><code class="objc">    ZMClientMessage *message = [ZMClientMessage insertNewObjectInManagedObjectContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1496</td>
<td class="src"><pre><code class="objc">    [message addData:genericMessage.data];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1497</td>
<td class="src"><pre><code class="objc">    message.sender = [ZMUser selfUserInContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1498</td>
<td class="src"><pre><code class="objc">    message.isEncrypted = YES;</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1499</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1500</td>
<td class="src"><pre><code class="objc">    if(hidden) {</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1501</td>
<td class="src"><pre><code class="objc">        message.hiddenInConversation = self;</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1502</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="missed">
<td class="num">1503</td>
<td class="src"><pre><code class="objc">    else {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1504</td>
<td class="src"><pre><code class="objc">        [self sortedAppendMessage:message];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1505</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">1506</td>
<td class="src"><pre><code class="objc">    return message;</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1507</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="never">
<td class="num">1508</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1509</td>
<td class="src"><pre><code class="objc">- (ZMClientMessage *)appendClientMessageWithData:(NSData *)data</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1510</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">751x</td>
</tr>
<tr class="covered">
<td class="num">1511</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(data != nil);</code></pre></td>
<td class="coverage">751x</td>
</tr>
<tr class="covered">
<td class="num">1512</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">751x</td>
</tr>
<tr class="covered">
<td class="num">1513</td>
<td class="src"><pre><code class="objc">    ZMClientMessage *message = [ZMClientMessage insertNewObjectInManagedObjectContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">751x</td>
</tr>
<tr class="covered">
<td class="num">1514</td>
<td class="src"><pre><code class="objc">    [message addData:data];</code></pre></td>
<td class="coverage">751x</td>
</tr>
<tr class="covered">
<td class="num">1515</td>
<td class="src"><pre><code class="objc">    message.sender = [ZMUser selfUserInContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">751x</td>
</tr>
<tr class="covered">
<td class="num">1516</td>
<td class="src"><pre><code class="objc">    [message setExpirationDate];</code></pre></td>
<td class="coverage">751x</td>
</tr>
<tr class="covered">
<td class="num">1517</td>
<td class="src"><pre><code class="objc">    [self sortedAppendMessage:message];</code></pre></td>
<td class="coverage">751x</td>
</tr>
<tr class="covered">
<td class="num">1518</td>
<td class="src"><pre><code class="objc">    return message;</code></pre></td>
<td class="coverage">751x</td>
</tr>
<tr class="covered">
<td class="num">1519</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">751x</td>
</tr>
<tr class="never">
<td class="num">1520</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1521</td>
<td class="src"><pre><code class="objc">- (ZMAssetClientMessage *)appendAssetClientMessageWithNonce:(NSUUID *)nonce hidden:(BOOL)hidden imageData:(NSData *)imageData</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1522</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1523</td>
<td class="src"><pre><code class="objc">    ZMAssetClientMessage *message = [ZMAssetClientMessage assetClientMessageWithOriginalImageData:imageData nonce:nonce managedObjectContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1524</td>
<td class="src"><pre><code class="objc">    message.sender = [ZMUser selfUserInContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1525</td>
<td class="src"><pre><code class="objc">    if(hidden) {</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="missed">
<td class="num">1526</td>
<td class="src"><pre><code class="objc">        message.hiddenInConversation = self;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1527</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">1528</td>
<td class="src"><pre><code class="objc">    else {</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1529</td>
<td class="src"><pre><code class="objc">        [self sortedAppendMessage:message];</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1530</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1531</td>
<td class="src"><pre><code class="objc">    return message;</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1532</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="never">
<td class="num">1533</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1534</td>
<td class="src"><pre><code class="objc">- (ZMAssetClientMessage *)appendOTRMessageWithFileMetadata:(ZMFileMetadata *)fileMetadata nonce:(NSUUID *)nonce</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1535</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">1536</td>
<td class="src"><pre><code class="objc">    ZMAssetClientMessage *message = [ZMAssetClientMessage assetClientMessageWithFileMetadata:fileMetadata nonce:nonce managedObjectContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">1537</td>
<td class="src"><pre><code class="objc">    message.sender = [ZMUser selfUserInContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">1538</td>
<td class="src"><pre><code class="objc">    message.isEncrypted = YES;</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">1539</td>
<td class="src"><pre><code class="objc">    [self sortedAppendMessage:message];</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">1540</td>
<td class="src"><pre><code class="objc">    return message;</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="covered">
<td class="num">1541</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">9x</td>
</tr>
<tr class="never">
<td class="num">1542</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1543</td>
<td class="src"><pre><code class="objc">- (ZMClientMessage *)appendOTRMessageWithLocationData:(ZMLocationData *)locationData nonce:(NSUUID *)nonce</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1544</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1545</td>
<td class="src"><pre><code class="objc">    ZMGenericMessage *genericMessage = [ZMGenericMessage genericMessageWithLocation:locationData.zmLocation messageID:nonce.transportString];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1546</td>
<td class="src"><pre><code class="objc">    ZMClientMessage *message = [self appendClientMessageWithData:genericMessage.data];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1547</td>
<td class="src"><pre><code class="objc">    message.isEncrypted = YES;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1548</td>
<td class="src"><pre><code class="objc">    return message;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1549</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">1550</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1551</td>
<td class="src"><pre><code class="objc">- (ZMClientMessage *)appendOTRKnockMessageWithNonce:(NSUUID *)nonce</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1552</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1553</td>
<td class="src"><pre><code class="objc">    ZMGenericMessage *genericMessage = [ZMGenericMessage knockWithNonce:nonce.transportString];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1554</td>
<td class="src"><pre><code class="objc">    ZMClientMessage *message = [self appendClientMessageWithData:genericMessage.data];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1555</td>
<td class="src"><pre><code class="objc">    message.isEncrypted = YES;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1556</td>
<td class="src"><pre><code class="objc">    return message;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1557</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">1558</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1559</td>
<td class="src"><pre><code class="objc">- (ZMClientMessage *)appendOTRMessageWithText:(NSString *)text nonce:(NSUUID *)nonce</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1560</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">729x</td>
</tr>
<tr class="covered">
<td class="num">1561</td>
<td class="src"><pre><code class="objc">    ZMGenericMessage *genericMessage = [ZMGenericMessage messageWithText:text nonce:nonce.transportString];</code></pre></td>
<td class="coverage">729x</td>
</tr>
<tr class="covered">
<td class="num">1562</td>
<td class="src"><pre><code class="objc">    ZMClientMessage *message = [self appendClientMessageWithData:genericMessage.data];</code></pre></td>
<td class="coverage">729x</td>
</tr>
<tr class="covered">
<td class="num">1563</td>
<td class="src"><pre><code class="objc">    message.linkPreviewState = ZMLinkPreviewStateWaitingToBeProcessed;</code></pre></td>
<td class="coverage">729x</td>
</tr>
<tr class="covered">
<td class="num">1564</td>
<td class="src"><pre><code class="objc">    message.isEncrypted = YES;</code></pre></td>
<td class="coverage">729x</td>
</tr>
<tr class="covered">
<td class="num">1565</td>
<td class="src"><pre><code class="objc">    return message;</code></pre></td>
<td class="coverage">729x</td>
</tr>
<tr class="covered">
<td class="num">1566</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">729x</td>
</tr>
<tr class="never">
<td class="num">1567</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1568</td>
<td class="src"><pre><code class="objc">- (ZMAssetClientMessage *)appendOTRMessageWithImageData:(NSData *)imageData nonce:(NSUUID *)nonce</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1569</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1570</td>
<td class="src"><pre><code class="objc">    ZMAssetClientMessage *message = [self appendAssetClientMessageWithNonce:nonce hidden:false imageData:imageData];</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1571</td>
<td class="src"><pre><code class="objc">    message.isEncrypted = YES;</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1572</td>
<td class="src"><pre><code class="objc">    return message;</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="covered">
<td class="num">1573</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">20x</td>
</tr>
<tr class="never">
<td class="num">1574</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1575</td>
<td class="src"><pre><code class="objc">- (ZMClientMessage *)appendOTRSessionResetMessage</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1576</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">1577</td>
<td class="src"><pre><code class="objc">    ZMGenericMessage *genericMessage = [ZMGenericMessage sessionResetWithNonce:NSUUID.UUID.transportString];</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">1578</td>
<td class="src"><pre><code class="objc">    ZMClientMessage *message = [self appendClientMessageWithData:genericMessage.data];</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">1579</td>
<td class="src"><pre><code class="objc">    message.isEncrypted = YES;</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">1580</td>
<td class="src"><pre><code class="objc">    return message;</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">1581</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="never">
<td class="num">1582</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1583</td>
<td class="src"><pre><code class="objc">- (void)appendNewConversationSystemMessageIfNeeded;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1584</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">169x</td>
</tr>
<tr class="covered">
<td class="num">1585</td>
<td class="src"><pre><code class="objc">    ZMMessage *firstMessage = self.messages.firstObject;</code></pre></td>
<td class="coverage">169x</td>
</tr>
<tr class="covered">
<td class="num">1586</td>
<td class="src"><pre><code class="objc">    if ([firstMessage isKindOfClass:[ZMSystemMessage class]]) {</code></pre></td>
<td class="coverage">169x</td>
</tr>
<tr class="covered">
<td class="num">1587</td>
<td class="src"><pre><code class="objc">        ZMSystemMessage *systemMessage = (ZMSystemMessage *)firstMessage;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1588</td>
<td class="src"><pre><code class="objc">        if (systemMessage.systemMessageType == ZMSystemMessageTypeNewConversation) {</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1589</td>
<td class="src"><pre><code class="objc">            return;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1590</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1591</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1592</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">169x</td>
</tr>
<tr class="covered">
<td class="num">1593</td>
<td class="src"><pre><code class="objc">    ZMSystemMessage *systemMessage = [ZMSystemMessage insertNewObjectInManagedObjectContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1594</td>
<td class="src"><pre><code class="objc">    systemMessage.systemMessageType = ZMSystemMessageTypeNewConversation;</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1595</td>
<td class="src"><pre><code class="objc">    systemMessage.sender = [ZMUser selfUserInContext:self.managedObjectContext];</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1596</td>
<td class="src"><pre><code class="objc">    systemMessage.isEncrypted = NO;</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1597</td>
<td class="src"><pre><code class="objc">    systemMessage.isPlainText = YES;</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1598</td>
<td class="src"><pre><code class="objc">    systemMessage.nonce = [NSUUID new];</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1599</td>
<td class="src"><pre><code class="objc">    systemMessage.sender = self.creator;</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1600</td>
<td class="src"><pre><code class="objc">    systemMessage.users = self.activeParticipants.set;</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1601</td>
<td class="src"><pre><code class="objc">    // the new conversation message should be displayed first,</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1602</td>
<td class="src"><pre><code class="objc">    // additionally the use of reference date is to ensure proper transition for older clients so the message is the very</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1603</td>
<td class="src"><pre><code class="objc">    // first message in conversation</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1604</td>
<td class="src"><pre><code class="objc">    systemMessage.serverTimestamp = [NSDate dateWithTimeIntervalSinceReferenceDate:0];</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1605</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1606</td>
<td class="src"><pre><code class="objc">    [self sortedAppendMessage:systemMessage];</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1607</td>
<td class="src"><pre><code class="objc">    systemMessage.visibleInConversation = self;</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="covered">
<td class="num">1608</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">167x</td>
</tr>
<tr class="never">
<td class="num">1609</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1610</td>
<td class="src"><pre><code class="objc">- (NSUInteger)sortedAppendMessage:(ZMMessage *)message;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1611</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1612</td>
<td class="src"><pre><code class="objc">    Require(message != nil);</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1613</td>
<td class="src"><pre><code class="objc">    // This is more efficient than adding to mutableMessages and re-sorting all of them.</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1614</td>
<td class="src"><pre><code class="objc">    NSUInteger index = self.messages.count;</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1615</td>
<td class="src"><pre><code class="objc">    ZMMessage * const currentLastMessage = self.messages.lastObject;</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1616</td>
<td class="src"><pre><code class="objc">    Require(currentLastMessage != message);</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1617</td>
<td class="src"><pre><code class="objc">    if (currentLastMessage == nil) {</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1618</td>
<td class="src"><pre><code class="objc">        [self.mutableMessages addObject:message];</code></pre></td>
<td class="coverage">405x</td>
</tr>
<tr class="covered">
<td class="num">1619</td>
<td class="src"><pre><code class="objc">    } else {</code></pre></td>
<td class="coverage">648x</td>
</tr>
<tr class="covered">
<td class="num">1620</td>
<td class="src"><pre><code class="objc">        if ([currentLastMessage compare:message] == NSOrderedAscending) {</code></pre></td>
<td class="coverage">648x</td>
</tr>
<tr class="covered">
<td class="num">1621</td>
<td class="src"><pre><code class="objc">            [self.mutableMessages addObject:message];</code></pre></td>
<td class="coverage">604x</td>
</tr>
<tr class="covered">
<td class="num">1622</td>
<td class="src"><pre><code class="objc">        } else {</code></pre></td>
<td class="coverage">44x</td>
</tr>
<tr class="covered">
<td class="num">1623</td>
<td class="src"><pre><code class="objc">            NSUInteger idx = [self.messages.array indexOfObject:message inSortedRange:NSMakeRange(0, self.messages.count) options:NSBinarySearchingInsertionIndex | NSBinarySearchingLastEqual usingComparator:^(ZMMessage *msg1, ZMMessage *msg2) {</code></pre></td>
<td class="coverage">76x</td>
</tr>
<tr class="covered">
<td class="num">1624</td>
<td class="src"><pre><code class="objc">                return [msg1 compare:msg2];</code></pre></td>
<td class="coverage">76x</td>
</tr>
<tr class="covered">
<td class="num">1625</td>
<td class="src"><pre><code class="objc">            }];</code></pre></td>
<td class="coverage">76x</td>
</tr>
<tr class="covered">
<td class="num">1626</td>
<td class="src"><pre><code class="objc">            [self.mutableMessages insertObject:message atIndex:idx];</code></pre></td>
<td class="coverage">44x</td>
</tr>
<tr class="covered">
<td class="num">1627</td>
<td class="src"><pre><code class="objc">            index = idx;</code></pre></td>
<td class="coverage">44x</td>
</tr>
<tr class="covered">
<td class="num">1628</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">44x</td>
</tr>
<tr class="covered">
<td class="num">1629</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">648x</td>
</tr>
<tr class="covered">
<td class="num">1630</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1631</td>
<td class="src"><pre><code class="objc">    NSPredicate *localSystemMessagePredicate = [ZMSystemMessage predicateForSystemMessagesInsertedLocally];</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1632</td>
<td class="src"><pre><code class="objc">    if ([message.serverTimestamp compare:self.lastModifiedDate] == NSOrderedDescending</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1633</td>
<td class="src"><pre><code class="objc">       &amp;&amp; ![localSystemMessagePredicate evaluateWithObject:message]) {</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1634</td>
<td class="src"><pre><code class="objc">        self.lastModifiedDate = message.serverTimestamp;</code></pre></td>
<td class="coverage">41x</td>
</tr>
<tr class="covered">
<td class="num">1635</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">41x</td>
</tr>
<tr class="covered">
<td class="num">1636</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1637</td>
<td class="src"><pre><code class="objc">    return index;</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="covered">
<td class="num">1638</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">1050x</td>
</tr>
<tr class="never">
<td class="num">1639</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1640</td>
<td class="src"><pre><code class="objc">- (void)deleteOlderMessages</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1641</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">18x</td>
</tr>
<tr class="covered">
<td class="num">1642</td>
<td class="src"><pre><code class="objc">    if ( self.messages.count == 0 || self.clearedTimeStamp == nil) {</code></pre></td>
<td class="coverage">18x</td>
</tr>
<tr class="covered">
<td class="num">1643</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1644</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1645</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">18x</td>
</tr>
<tr class="covered">
<td class="num">1646</td>
<td class="src"><pre><code class="objc">    // If messages are not sorted beforehand, we might delete messages we were supposed to keep</code></pre></td>
<td class="coverage">18x</td>
</tr>
<tr class="covered">
<td class="num">1647</td>
<td class="src"><pre><code class="objc">    [self sortMessages];</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1648</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1649</td>
<td class="src"><pre><code class="objc">    NSMutableArray *messagesToDelete = [NSMutableArray array];</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1650</td>
<td class="src"><pre><code class="objc">    [self.messages enumerateObjectsUsingBlock:^(ZMSystemMessage *message, NSUInteger __unused idx, BOOL *stop) {</code></pre></td>
<td class="coverage">33x</td>
</tr>
<tr class="covered">
<td class="num">1651</td>
<td class="src"><pre><code class="objc">        NOT_USED(stop);</code></pre></td>
<td class="coverage">33x</td>
</tr>
<tr class="covered">
<td class="num">1652</td>
<td class="src"><pre><code class="objc">        // cleared event can be an invisible event that is not a message</code></pre></td>
<td class="coverage">33x</td>
</tr>
<tr class="covered">
<td class="num">1653</td>
<td class="src"><pre><code class="objc">        // therefore we should stop when we reach a message that is older than the clearedTimestamp</code></pre></td>
<td class="coverage">33x</td>
</tr>
<tr class="covered">
<td class="num">1654</td>
<td class="src"><pre><code class="objc">        if ([message.serverTimestamp compare:self.clearedTimeStamp] == NSOrderedDescending) {</code></pre></td>
<td class="coverage">33x</td>
</tr>
<tr class="covered">
<td class="num">1655</td>
<td class="src"><pre><code class="objc">            *stop = YES;</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="covered">
<td class="num">1656</td>
<td class="src"><pre><code class="objc">            return;</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="covered">
<td class="num">1657</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">5x</td>
</tr>
<tr class="covered">
<td class="num">1658</td>
<td class="src"><pre><code class="objc">        [messagesToDelete addObject:message];</code></pre></td>
<td class="coverage">28x</td>
</tr>
<tr class="covered">
<td class="num">1659</td>
<td class="src"><pre><code class="objc">    }];</code></pre></td>
<td class="coverage">28x</td>
</tr>
<tr class="covered">
<td class="num">1660</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1661</td>
<td class="src"><pre><code class="objc">    for (ZMMessage *message in messagesToDelete) {</code></pre></td>
<td class="coverage">28x</td>
</tr>
<tr class="covered">
<td class="num">1662</td>
<td class="src"><pre><code class="objc">        [self.managedObjectContext deleteObject:message];</code></pre></td>
<td class="coverage">28x</td>
</tr>
<tr class="covered">
<td class="num">1663</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">28x</td>
</tr>
<tr class="covered">
<td class="num">1664</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="never">
<td class="num">1665</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1666</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1667</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1668</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1669</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1670</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1671</td>
<td class="src"><pre><code class="objc">@implementation ZMConversation (SelfConversation)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1672</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1673</td>
<td class="src"><pre><code class="objc">+ (ZMClientMessage *)appendSelfConversationWithGenericMessageData:(NSData * )messageData managedObjectContext:(NSManagedObjectContext *)moc;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1674</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1675</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(messageData != nil);</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1676</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1677</td>
<td class="src"><pre><code class="objc">    ZMConversation *selfConversation = [ZMConversation selfConversationInContext:moc];</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1678</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(selfConversation != nil);</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1679</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1680</td>
<td class="src"><pre><code class="objc">    ZMClientMessage *clientMessage = [selfConversation appendClientMessageWithData:messageData];</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1681</td>
<td class="src"><pre><code class="objc">    clientMessage.isEncrypted = YES;</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1682</td>
<td class="src"><pre><code class="objc">    [clientMessage removeExpirationDate]; // Self messages don't expire since we always want to keep last read / cleared updates in-sync</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1683</td>
<td class="src"><pre><code class="objc">    return clientMessage;</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">1684</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="never">
<td class="num">1685</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1686</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1687</td>
<td class="src"><pre><code class="objc">+ (ZMClientMessage *)appendSelfConversationWithLastReadOfConversation:(ZMConversation *)conversation</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1688</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1689</td>
<td class="src"><pre><code class="objc">    NSDate *lastRead = conversation.lastReadServerTimeStamp;</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1690</td>
<td class="src"><pre><code class="objc">    NSUUID *convID = conversation.remoteIdentifier;</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1691</td>
<td class="src"><pre><code class="objc">    if (convID == nil || lastRead == nil || [convID isEqual:[ZMConversation selfConversationIdentifierInContext:conversation.managedObjectContext]]) {</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="missed">
<td class="num">1692</td>
<td class="src"><pre><code class="objc">        return nil;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1693</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">1694</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1695</td>
<td class="src"><pre><code class="objc">    NSUUID *nonce = [NSUUID UUID];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1696</td>
<td class="src"><pre><code class="objc">    ZMGenericMessage *message = [ZMGenericMessage messageWithLastRead:lastRead ofConversationWithID:convID.transportString nonce:nonce.transportString];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1697</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(message != nil);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1698</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1699</td>
<td class="src"><pre><code class="objc">    return [self appendSelfConversationWithGenericMessageData:message.data managedObjectContext:conversation.managedObjectContext];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1700</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="never">
<td class="num">1701</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1702</td>
<td class="src"><pre><code class="objc">+ (void)updateConversationWithZMLastReadFromSelfConversation:(ZMLastRead *)lastRead inContext:(NSManagedObjectContext *)context</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1703</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1704</td>
<td class="src"><pre><code class="objc">    double newTimeStamp = lastRead.lastReadTimestamp;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1705</td>
<td class="src"><pre><code class="objc">    NSDate *timestamp = [NSDate dateWithTimeIntervalSince1970:(newTimeStamp/1000)];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1706</td>
<td class="src"><pre><code class="objc">    NSUUID *conversationID = [NSUUID uuidWithTransportString:lastRead.conversationId];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1707</td>
<td class="src"><pre><code class="objc">    if (conversationID == nil || timestamp == nil) {</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="missed">
<td class="num">1708</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1709</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">1710</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1711</td>
<td class="src"><pre><code class="objc">    ZMConversation *conversationToUpdate = [ZMConversation conversationWithRemoteID:conversationID createIfNeeded:YES inContext:context];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1712</td>
<td class="src"><pre><code class="objc">    [conversationToUpdate updateLastReadServerTimeStampIfNeededWithTimeStamp:timestamp andSync:NO];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1713</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">1714</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1715</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1716</td>
<td class="src"><pre><code class="objc">+ (ZMClientMessage *)appendSelfConversationWithClearedOfConversation:(ZMConversation *)conversation</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1717</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1718</td>
<td class="src"><pre><code class="objc">    NSUUID *convID = conversation.remoteIdentifier;</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1719</td>
<td class="src"><pre><code class="objc">    NSDate *cleared = conversation.clearedTimeStamp;</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1720</td>
<td class="src"><pre><code class="objc">    if (convID == nil || cleared == nil || [convID isEqual:[ZMConversation selfConversationIdentifierInContext:conversation.managedObjectContext]]) {</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="missed">
<td class="num">1721</td>
<td class="src"><pre><code class="objc">        return nil;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1722</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="covered">
<td class="num">1723</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1724</td>
<td class="src"><pre><code class="objc">    NSUUID *nonce = [NSUUID UUID];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1725</td>
<td class="src"><pre><code class="objc">    ZMGenericMessage *message = [ZMGenericMessage messageWithClearedTimestamp:cleared ofConversationWithID:convID.transportString nonce:nonce.transportString];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1726</td>
<td class="src"><pre><code class="objc">    VerifyReturnNil(message != nil);</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1727</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1728</td>
<td class="src"><pre><code class="objc">    return [self appendSelfConversationWithGenericMessageData:message.data managedObjectContext:conversation.managedObjectContext];</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="covered">
<td class="num">1729</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">3x</td>
</tr>
<tr class="never">
<td class="num">1730</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1731</td>
<td class="src"><pre><code class="objc">+ (void)updateConversationWithZMClearedFromSelfConversation:(ZMCleared *)cleared inContext:(NSManagedObjectContext *)context</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">1732</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1733</td>
<td class="src"><pre><code class="objc">    double newTimeStamp = cleared.clearedTimestamp;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1734</td>
<td class="src"><pre><code class="objc">    NSDate *timestamp = [NSDate dateWithTimeIntervalSince1970:(newTimeStamp/1000)];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1735</td>
<td class="src"><pre><code class="objc">    NSUUID *conversationID = [NSUUID uuidWithTransportString:cleared.conversationId];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1736</td>
<td class="src"><pre><code class="objc">    if (conversationID == nil || timestamp == nil) {</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1737</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1738</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1739</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1740</td>
<td class="src"><pre><code class="objc">    ZMConversation *conversationToUpdate = [ZMConversation conversationWithRemoteID:conversationID createIfNeeded:YES inContext:context];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1741</td>
<td class="src"><pre><code class="objc">    [conversationToUpdate updateClearedServerTimeStampIfNeeded:timestamp andSync:NO];</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">1742</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">1743</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1744</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1745</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1746</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1747</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1748</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1749</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1750</td>
<td class="src"><pre><code class="objc">@implementation ZMConversation (ParticipantsInternal)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1751</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1752</td>
<td class="src"><pre><code class="objc">- (void)internalAddParticipant:(ZMUser *)participant isAuthoritative:(BOOL)isAuthoritative;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1753</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">610x</td>
</tr>
<tr class="covered">
<td class="num">1754</td>
<td class="src"><pre><code class="objc">    VerifyReturn(participant != nil);</code></pre></td>
<td class="coverage">610x</td>
</tr>
<tr class="covered">
<td class="num">1755</td>
<td class="src"><pre><code class="objc">    RequireString([participant isKindOfClass:ZMUser.class], "Participant must be a ZMUser");</code></pre></td>
<td class="coverage">610x</td>
</tr>
<tr class="covered">
<td class="num">1756</td>
<td class="src"><pre><code class="objc">    if (participant.isSelfUser) {</code></pre></td>
<td class="coverage">610x</td>
</tr>
<tr class="covered">
<td class="num">1757</td>
<td class="src"><pre><code class="objc">        self.isSelfAnActiveMember = YES;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1758</td>
<td class="src"><pre><code class="objc">        self.needsToBeUpdatedFromBackend = YES;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1759</td>
<td class="src"><pre><code class="objc">    } else {</code></pre></td>
<td class="coverage">608x</td>
</tr>
<tr class="covered">
<td class="num">1760</td>
<td class="src"><pre><code class="objc">        [self.mutableOtherActiveParticipants addObject:participant];</code></pre></td>
<td class="coverage">608x</td>
</tr>
<tr class="covered">
<td class="num">1761</td>
<td class="src"><pre><code class="objc">        [self.mutableOtherInactiveParticipants removeObject:participant];</code></pre></td>
<td class="coverage">608x</td>
</tr>
<tr class="covered">
<td class="num">1762</td>
<td class="src"><pre><code class="objc">        if(isAuthoritative) {</code></pre></td>
<td class="coverage">608x</td>
</tr>
<tr class="covered">
<td class="num">1763</td>
<td class="src"><pre><code class="objc">            [self.mutableLastServerSyncedActiveParticipants addObject:participant];</code></pre></td>
<td class="coverage">36x</td>
</tr>
<tr class="covered">
<td class="num">1764</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">36x</td>
</tr>
<tr class="covered">
<td class="num">1765</td>
<td class="src"><pre><code class="objc">        [self decreaseSecurityLevelIfNeededAfterUserClientsWereIgnored:participant.clients];</code></pre></td>
<td class="coverage">608x</td>
</tr>
<tr class="covered">
<td class="num">1766</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">608x</td>
</tr>
<tr class="covered">
<td class="num">1767</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">610x</td>
</tr>
<tr class="never">
<td class="num">1768</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1769</td>
<td class="src"><pre><code class="objc">- (void)internalRemoveParticipant:(ZMUser *)participant sender:(ZMUser *)sender;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1770</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1771</td>
<td class="src"><pre><code class="objc">    VerifyReturn(participant != nil);</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1772</td>
<td class="src"><pre><code class="objc">    RequireString([participant isKindOfClass:ZMUser.class], "Participant must be a ZMUser");</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1773</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1774</td>
<td class="src"><pre><code class="objc">    if (participant.isSelfUser) {</code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1775</td>
<td class="src"><pre><code class="objc">        self.isSelfAnActiveMember = NO;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1776</td>
<td class="src"><pre><code class="objc">        self.isArchived = sender.isSelfUser;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1777</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1778</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1779</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">50x</td>
</tr>
<tr class="covered">
<td class="num">1780</td>
<td class="src"><pre><code class="objc">    if (! [self.otherActiveParticipants containsObject:participant]) {</code></pre></td>
<td class="coverage">44x</td>
</tr>
<tr class="covered">
<td class="num">1781</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1782</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1783</td>
<td class="src"><pre><code class="objc">    [self.mutableOtherActiveParticipants removeObject:participant];</code></pre></td>
<td class="coverage">42x</td>
</tr>
<tr class="covered">
<td class="num">1784</td>
<td class="src"><pre><code class="objc">    [self.mutableOtherInactiveParticipants addObject:participant];</code></pre></td>
<td class="coverage">42x</td>
</tr>
<tr class="covered">
<td class="num">1785</td>
<td class="src"><pre><code class="objc">    [self increaseSecurityLevelIfNeededAfterRemovingClientForUser:participant];</code></pre></td>
<td class="coverage">42x</td>
</tr>
<tr class="covered">
<td class="num">1786</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">42x</td>
</tr>
<tr class="never">
<td class="num">1787</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1788</td>
<td class="src"><pre><code class="objc">@dynamic isSelfAnActiveMember;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1789</td>
<td class="src"><pre><code class="objc">@dynamic otherActiveParticipants;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1790</td>
<td class="src"><pre><code class="objc">@dynamic otherInactiveParticipants;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1791</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1792</td>
<td class="src"><pre><code class="objc">- (NSMutableOrderedSet *)mutableOtherInactiveParticipants;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1793</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">672x</td>
</tr>
<tr class="covered">
<td class="num">1794</td>
<td class="src"><pre><code class="objc">    return [self mutableOrderedSetValueForKey:OtherInactiveParticipantsKey];</code></pre></td>
<td class="coverage">672x</td>
</tr>
<tr class="covered">
<td class="num">1795</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">672x</td>
</tr>
<tr class="never">
<td class="num">1796</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1797</td>
<td class="src"><pre><code class="objc">- (NSMutableOrderedSet *)mutableOtherActiveParticipants;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1798</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">867x</td>
</tr>
<tr class="covered">
<td class="num">1799</td>
<td class="src"><pre><code class="objc">    return [self mutableOrderedSetValueForKey:ZMConversationOtherActiveParticipantsKey];</code></pre></td>
<td class="coverage">867x</td>
</tr>
<tr class="covered">
<td class="num">1800</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">867x</td>
</tr>
<tr class="never">
<td class="num">1801</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1802</td>
<td class="src"><pre><code class="objc">- (void)synchronizeRemovedUser:(ZMUser *)user</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1803</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1804</td>
<td class="src"><pre><code class="objc">    [self.mutableLastServerSyncedActiveParticipants removeObject:user];</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1805</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="never">
<td class="num">1806</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1807</td>
<td class="src"><pre><code class="objc">- (void)synchronizeAddedUser:(ZMUser *)user</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1808</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">100x</td>
</tr>
<tr class="covered">
<td class="num">1809</td>
<td class="src"><pre><code class="objc">    if (user.isSelfUser) {</code></pre></td>
<td class="coverage">100x</td>
</tr>
<tr class="covered">
<td class="num">1810</td>
<td class="src"><pre><code class="objc">        return; // The self user should never be in the 'active' list.</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1811</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1812</td>
<td class="src"><pre><code class="objc">    [self.mutableLastServerSyncedActiveParticipants addObject:user];</code></pre></td>
<td class="coverage">98x</td>
</tr>
<tr class="covered">
<td class="num">1813</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">98x</td>
</tr>
<tr class="never">
<td class="num">1814</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1815</td>
<td class="src"><pre><code class="objc">- (NSOrderedSet *)unsyncedInactiveParticipants</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1816</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">5310x</td>
</tr>
<tr class="covered">
<td class="num">1817</td>
<td class="src"><pre><code class="objc">    NSMutableOrderedSet *set = [self.mutableLastServerSyncedActiveParticipants mutableCopy];</code></pre></td>
<td class="coverage">5310x</td>
</tr>
<tr class="covered">
<td class="num">1818</td>
<td class="src"><pre><code class="objc">    [set minusOrderedSet:self.otherActiveParticipants];</code></pre></td>
<td class="coverage">5310x</td>
</tr>
<tr class="covered">
<td class="num">1819</td>
<td class="src"><pre><code class="objc">    return set;</code></pre></td>
<td class="coverage">5310x</td>
</tr>
<tr class="covered">
<td class="num">1820</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">5310x</td>
</tr>
<tr class="never">
<td class="num">1821</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1822</td>
<td class="src"><pre><code class="objc">- (NSOrderedSet *)unsyncedActiveParticipants</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1823</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">5310x</td>
</tr>
<tr class="covered">
<td class="num">1824</td>
<td class="src"><pre><code class="objc">    NSMutableOrderedSet *set = [self.otherActiveParticipants mutableCopy];</code></pre></td>
<td class="coverage">5310x</td>
</tr>
<tr class="covered">
<td class="num">1825</td>
<td class="src"><pre><code class="objc">    [set minusOrderedSet:self.mutableLastServerSyncedActiveParticipants];</code></pre></td>
<td class="coverage">5310x</td>
</tr>
<tr class="covered">
<td class="num">1826</td>
<td class="src"><pre><code class="objc">    return set;</code></pre></td>
<td class="coverage">5310x</td>
</tr>
<tr class="covered">
<td class="num">1827</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">5310x</td>
</tr>
<tr class="never">
<td class="num">1828</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1829</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1830</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1831</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1832</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1833</td>
<td class="src"><pre><code class="objc">@implementation ZMConversation (DownloadedMessagesGaps)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1834</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1835</td>
<td class="src"><pre><code class="objc">- (void)addEventToDownloadedEvents:(ZMEventID *)eventID timeStamp:(NSDate *)timeStamp;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1836</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">457x</td>
</tr>
<tr class="covered">
<td class="num">1837</td>
<td class="src"><pre><code class="objc">    if(eventID == nil) {</code></pre></td>
<td class="coverage">457x</td>
</tr>
<tr class="covered">
<td class="num">1838</td>
<td class="src"><pre><code class="objc">        return;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1839</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1840</td>
<td class="src"><pre><code class="objc">    self.downloadedMessageIDs = [self.downloadedMessageIDs setByAddingRange:[[ZMEventIDRange alloc] initWithEventIDs:@[eventID]]];</code></pre></td>
<td class="coverage">453x</td>
</tr>
<tr class="covered">
<td class="num">1841</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">453x</td>
</tr>
<tr class="covered">
<td class="num">1842</td>
<td class="src"><pre><code class="objc">    if (timeStamp != nil) {</code></pre></td>
<td class="coverage">453x</td>
</tr>
<tr class="covered">
<td class="num">1843</td>
<td class="src"><pre><code class="objc">        if (self.lastReadEventID != nil &amp;&amp; [eventID isEqualToEventID:self.lastReadEventID]) {</code></pre></td>
<td class="coverage">449x</td>
</tr>
<tr class="covered">
<td class="num">1844</td>
<td class="src"><pre><code class="objc">            if ([self updateLastReadServerTimeStampIfNeededWithTimeStamp:timeStamp andSync:NO]) {</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1845</td>
<td class="src"><pre><code class="objc">                [self didUpdateConversationWhileFetchingUnreadMessages];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1846</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1847</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1848</td>
<td class="src"><pre><code class="objc">        if (self.clearedEventID != nil) {</code></pre></td>
<td class="coverage">449x</td>
</tr>
<tr class="covered">
<td class="num">1849</td>
<td class="src"><pre><code class="objc">            if ([eventID isEqualToEventID:self.clearedEventID]) {</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1850</td>
<td class="src"><pre><code class="objc">                [self updateClearedServerTimeStampIfNeeded:timeStamp andSync:NO];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1851</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1852</td>
<td class="src"><pre><code class="objc">            if (self.clearedTimeStamp == nil  &amp;&amp; eventID.major == (self.clearedEventID.major+1)) {</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1853</td>
<td class="src"><pre><code class="objc">                // when setting the clearedEventID, we are closing the gap and won't download the clearedEvent again</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1854</td>
<td class="src"><pre><code class="objc">                // therefore we will never set an initial clearedTimeStamp</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1855</td>
<td class="src"><pre><code class="objc">                // we approximate here by setting to a time close the first new event</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1856</td>
<td class="src"><pre><code class="objc">                [self updateClearedServerTimeStampIfNeeded:[timeStamp dateByAddingTimeInterval:-1] andSync:NO];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1857</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1858</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">6x</td>
</tr>
<tr class="covered">
<td class="num">1859</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">449x</td>
</tr>
<tr class="covered">
<td class="num">1860</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">453x</td>
</tr>
<tr class="never">
<td class="num">1861</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1862</td>
<td class="src"><pre><code class="objc">- (void)addEventRangeToDownloadedEvents:(ZMEventIDRange *)eventIDRange;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1863</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">1864</td>
<td class="src"><pre><code class="objc">    self.downloadedMessageIDs = [self.downloadedMessageIDs setByAddingRange:eventIDRange];</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="covered">
<td class="num">1865</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">43x</td>
</tr>
<tr class="never">
<td class="num">1866</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1867</td>
<td class="src"><pre><code class="objc">- (ZMEventIDRange *)lastEventIDGapForVisibleWindow:(ZMEventIDRange *)visibleWindow;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1868</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">1869</td>
<td class="src"><pre><code class="objc">    ZMEventIDRange *window = [self windowWithVisibleWindow:visibleWindow];</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">1870</td>
<td class="src"><pre><code class="objc">    return [self lastGapInsideWindow:window lastMajor:window.oldestMessage.major windowBleed:ZMLeadingEventIDWindowBleed];</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">1871</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="never">
<td class="num">1872</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1873</td>
<td class="src"><pre><code class="objc">- (ZMEventIDRange *)eventIDRangeForEntireConversation</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1874</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1875</td>
<td class="src"><pre><code class="objc">    ZMEventID *firstEvent = self.clearedEventID ? self.clearedEventID : [ZMEventID eventIDWithMajor:1 minor:0];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1876</td>
<td class="src"><pre><code class="objc">    ZMEventID *lastEvent = self.lastEventID;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1877</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1878</td>
<td class="src"><pre><code class="objc">    return [[ZMEventIDRange alloc] initWithEventIDs:@[firstEvent, lastEvent]];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1879</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">1880</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1881</td>
<td class="src"><pre><code class="objc">- (ZMEventIDRange *)lastEventIDGap</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1882</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1883</td>
<td class="src"><pre><code class="objc">    if(self.lastEventID == nil) {</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1884</td>
<td class="src"><pre><code class="objc">        return nil;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1885</td>
<td class="src"><pre><code class="objc">    } else {</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1886</td>
<td class="src"><pre><code class="objc">        return [self lastGapInsideWindow:[self eventIDRangeForEntireConversation] lastMajor:self.lastEventID.major windowBleed:0];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1887</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1888</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">1889</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1890</td>
<td class="src"><pre><code class="objc">- (ZMEventIDRange *)windowWithVisibleWindow:(ZMEventIDRange *)visibleWindow</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1891</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">1892</td>
<td class="src"><pre><code class="objc">    if (self.lastEventID == nil) {</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="covered">
<td class="num">1893</td>
<td class="src"><pre><code class="objc">        return nil;</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1894</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1895</td>
<td class="src"><pre><code class="objc">    ZMEventIDRange *window = [[ZMEventIDRange alloc] init];</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">1896</td>
<td class="src"><pre><code class="objc">    [window addEvent:self.lastEventID];</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">1897</td>
<td class="src"><pre><code class="objc">    if (self.lastReadEventID) {</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">1898</td>
<td class="src"><pre><code class="objc">        [window addEvent:self.lastReadEventID];</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">1899</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">1900</td>
<td class="src"><pre><code class="objc">    if(visibleWindow) {</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">1901</td>
<td class="src"><pre><code class="objc">        [window mergeRange:visibleWindow];</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1902</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1903</td>
<td class="src"><pre><code class="objc">    return window;</code></pre></td>
<td class="coverage">10x</td>
</tr>
<tr class="covered">
<td class="num">1904</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">14x</td>
</tr>
<tr class="never">
<td class="num">1905</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1906</td>
<td class="src"><pre><code class="objc">- (ZMEventIDRange *)lastGapInsideWindow:(ZMEventIDRange *)window lastMajor:(uint64_t)lastMajor windowBleed:(NSUInteger)windowBleed</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1907</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1908</td>
<td class="src"><pre><code class="objc">    uint64_t lowerBound = 1;</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1909</td>
<td class="src"><pre><code class="objc">    if( windowBleed &lt; lastMajor) {</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1910</td>
<td class="src"><pre><code class="objc">        lowerBound = lastMajor - windowBleed;</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1911</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">12x</td>
</tr>
<tr class="covered">
<td class="num">1912</td>
<td class="src"><pre><code class="objc">    [window addEvent:[[ZMEventID alloc] initWithMajor:lowerBound minor:0]];</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1913</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1914</td>
<td class="src"><pre><code class="objc">    ZMEventIDRange *gap = ((self.downloadedMessageIDs != nil) ? [self.downloadedMessageIDs lastGapWithinWindow:window] : window);</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1915</td>
<td class="src"><pre><code class="objc">    return gap;</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="covered">
<td class="num">1916</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">16x</td>
</tr>
<tr class="never">
<td class="num">1917</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1918</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1919</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1920</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1921</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1922</td>
<td class="src"><pre><code class="objc">@implementation ZMConversation (ZMVoiceChannel)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1923</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1924</td>
<td class="src"><pre><code class="objc">- (ZMVoiceChannel *)voiceChannel;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1925</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">9060x</td>
</tr>
<tr class="covered">
<td class="num">1926</td>
<td class="src"><pre><code class="objc">    // The 'voiceChannel' is a transient property in the model.</code></pre></td>
<td class="coverage">9060x</td>
</tr>
<tr class="covered">
<td class="num">1927</td>
<td class="src"><pre><code class="objc">    [self willAccessValueForKey:VoiceChannelKey];</code></pre></td>
<td class="coverage">9060x</td>
</tr>
<tr class="covered">
<td class="num">1928</td>
<td class="src"><pre><code class="objc">    ZMVoiceChannel *voiceChannel = self.primitiveVoiceChannel;</code></pre></td>
<td class="coverage">9060x</td>
</tr>
<tr class="covered">
<td class="num">1929</td>
<td class="src"><pre><code class="objc">    [self didAccessValueForKey:VoiceChannelKey];</code></pre></td>
<td class="coverage">9060x</td>
</tr>
<tr class="covered">
<td class="num">1930</td>
<td class="src"><pre><code class="objc">    if (voiceChannel == nil) {</code></pre></td>
<td class="coverage">9060x</td>
</tr>
<tr class="covered">
<td class="num">1931</td>
<td class="src"><pre><code class="objc">        if ((self.conversationType == ZMConversationTypeOneOnOne) ||</code></pre></td>
<td class="coverage">7560x</td>
</tr>
<tr class="covered">
<td class="num">1932</td>
<td class="src"><pre><code class="objc">            (self.conversationType == ZMConversationTypeGroup))</code></pre></td>
<td class="coverage">7380x</td>
</tr>
<tr class="covered">
<td class="num">1933</td>
<td class="src"><pre><code class="objc">        {</code></pre></td>
<td class="coverage">443x</td>
</tr>
<tr class="covered">
<td class="num">1934</td>
<td class="src"><pre><code class="objc">            voiceChannel = [[ZMVoiceChannel alloc] initWithConversation:self];</code></pre></td>
<td class="coverage">443x</td>
</tr>
<tr class="covered">
<td class="num">1935</td>
<td class="src"><pre><code class="objc">            self.primitiveVoiceChannel = voiceChannel;</code></pre></td>
<td class="coverage">443x</td>
</tr>
<tr class="covered">
<td class="num">1936</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">443x</td>
</tr>
<tr class="covered">
<td class="num">1937</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">7560x</td>
</tr>
<tr class="covered">
<td class="num">1938</td>
<td class="src"><pre><code class="objc">    return voiceChannel;</code></pre></td>
<td class="coverage">9060x</td>
</tr>
<tr class="covered">
<td class="num">1939</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">9060x</td>
</tr>
<tr class="never">
<td class="num">1940</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1941</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1942</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1943</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1944</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1945</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1946</td>
<td class="src"><pre><code class="objc">@implementation ZMConversation (KeyValueValidation)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1947</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1948</td>
<td class="src"><pre><code class="objc">- (BOOL)validateUserDefinedName:(NSString **)ioName error:(NSError **)outError</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1949</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2410x</td>
</tr>
<tr class="covered">
<td class="num">1950</td>
<td class="src"><pre><code class="objc">    return [ZMStringLengthValidator validateValue:ioName mimimumStringLength:1 maximumSringLength:64 error:outError];</code></pre></td>
<td class="coverage">2410x</td>
</tr>
<tr class="covered">
<td class="num">1951</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2410x</td>
</tr>
<tr class="never">
<td class="num">1952</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1953</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1954</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1955</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1956</td>
<td class="src"><pre><code class="objc">@implementation ZMConversation (Connections)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1957</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1958</td>
<td class="src"><pre><code class="objc">- (NSString *)connectionMessage;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1959</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1960</td>
<td class="src"><pre><code class="objc">    return self.connection.message;</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="covered">
<td class="num">1961</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">2x</td>
</tr>
<tr class="never">
<td class="num">1962</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1963</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1964</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1965</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1966</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1967</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1968</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1969</td>
<td class="src"><pre><code class="objc">@implementation NSUUID (ZMSelfConversation)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1970</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1971</td>
<td class="src"><pre><code class="objc">- (BOOL)isSelfConversationRemoteIdentifierInContext:(NSManagedObjectContext *)moc;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1972</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1973</td>
<td class="src"><pre><code class="objc">    // The self conversation has the same remote ID as the self user:</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1974</td>
<td class="src"><pre><code class="objc">    return [self isSelfUserRemoteIdentifierInContext:moc];</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="covered">
<td class="num">1975</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">4x</td>
</tr>
<tr class="never">
<td class="num">1976</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1977</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1978</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1979</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1980</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1981</td>
<td class="src"><pre><code class="objc">@implementation ZMConversation (Optimization)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1982</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">1983</td>
<td class="src"><pre><code class="objc">+ (void)refreshObjectsThatAreNotNeededInSyncContext:(NSManagedObjectContext *)managedObjectContext;</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">1984</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">1985</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">1986</td>
<td class="src"><pre><code class="objc">    NSMutableArray *messagesToKeep = [NSMutableArray array];</code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">1987</td>
<td class="src"><pre><code class="objc">    NSMutableArray *conversationsToKeep = [NSMutableArray array];</code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">1988</td>
<td class="src"><pre><code class="objc">    NSMutableSet *usersToKeep = [NSMutableSet set];</code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">1989</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">1990</td>
<td class="src"><pre><code class="objc">    // make sure that the Set is not mutated while being enumerated</code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">1991</td>
<td class="src"><pre><code class="objc">    NSSet *registeredObjects = managedObjectContext.registeredObjects;</code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">1992</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">1993</td>
<td class="src"><pre><code class="objc">    // gather messages to keep</code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">1994</td>
<td class="src"><pre><code class="objc">    for(NSManagedObject *obj in registeredObjects) {</code></pre></td>
<td class="coverage">1740x</td>
</tr>
<tr class="covered">
<td class="num">1995</td>
<td class="src"><pre><code class="objc">        if(!obj.isFault &amp;&amp; [obj isKindOfClass:ZMConversation.class]) {</code></pre></td>
<td class="coverage">1740x</td>
</tr>
<tr class="covered">
<td class="num">1996</td>
<td class="src"><pre><code class="objc">            ZMConversation *conversation = (ZMConversation *)obj;</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">1997</td>
<td class="src"><pre><code class="objc">            [messagesToKeep addObjectsFromArray:[conversation messagesNotToRefreshBecauseNeededForSorting].allObjects];</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">1998</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">1999</td>
<td class="src"><pre><code class="objc">            if(conversation.shouldNotBeRefreshed) {</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2000</td>
<td class="src"><pre><code class="objc">                [conversationsToKeep addObject:conversation];</code></pre></td>
<td class="coverage">239x</td>
</tr>
<tr class="covered">
<td class="num">2001</td>
<td class="src"><pre><code class="objc">                [usersToKeep unionSet:conversation.otherActiveParticipants.set];</code></pre></td>
<td class="coverage">239x</td>
</tr>
<tr class="covered">
<td class="num">2002</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">239x</td>
</tr>
<tr class="covered">
<td class="num">2003</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2004</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">1740x</td>
</tr>
<tr class="covered">
<td class="num">2005</td>
<td class="src"><pre><code class="objc">    [usersToKeep addObject:[ZMUser selfUserInContext:managedObjectContext]];</code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">2006</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">2007</td>
<td class="src"><pre><code class="objc">    // turn into a fault</code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="covered">
<td class="num">2008</td>
<td class="src"><pre><code class="objc">    for(NSManagedObject *obj in registeredObjects) {</code></pre></td>
<td class="coverage">1740x</td>
</tr>
<tr class="covered">
<td class="num">2009</td>
<td class="src"><pre><code class="objc">        if(!obj.isFault) {</code></pre></td>
<td class="coverage">1740x</td>
</tr>
<tr class="covered">
<td class="num">2010</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">1600x</td>
</tr>
<tr class="covered">
<td class="num">2011</td>
<td class="src"><pre><code class="objc">            const BOOL isUser = [obj isKindOfClass:ZMUser.class];</code></pre></td>
<td class="coverage">1600x</td>
</tr>
<tr class="covered">
<td class="num">2012</td>
<td class="src"><pre><code class="objc">            const BOOL isMessage = [obj isKindOfClass:ZMMessage.class];</code></pre></td>
<td class="coverage">1600x</td>
</tr>
<tr class="covered">
<td class="num">2013</td>
<td class="src"><pre><code class="objc">            const BOOL isConversation = [obj isKindOfClass:ZMConversation.class];</code></pre></td>
<td class="coverage">1600x</td>
</tr>
<tr class="covered">
<td class="num">2014</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">1600x</td>
</tr>
<tr class="covered">
<td class="num">2015</td>
<td class="src"><pre><code class="objc">            const BOOL isOfTypeToBeRefreshed = isUser || isMessage || isConversation;</code></pre></td>
<td class="coverage">1160x</td>
</tr>
<tr class="covered">
<td class="num">2016</td>
<td class="src"><pre><code class="objc">            </code></pre></td>
<td class="coverage">1600x</td>
</tr>
<tr class="covered">
<td class="num">2017</td>
<td class="src"><pre><code class="objc">            if((isMessage &amp;&amp; [messagesToKeep indexOfObjectIdenticalTo:obj] != NSNotFound) ||</code></pre></td>
<td class="coverage">1600x</td>
</tr>
<tr class="covered">
<td class="num">2018</td>
<td class="src"><pre><code class="objc">               (isConversation &amp;&amp; [conversationsToKeep indexOfObjectIdenticalTo:obj] != NSNotFound) ||</code></pre></td>
<td class="coverage">1490x</td>
</tr>
<tr class="covered">
<td class="num">2019</td>
<td class="src"><pre><code class="objc">               (isUser &amp;&amp; [usersToKeep.allObjects indexOfObjectIdenticalTo:obj] != NSNotFound) ||</code></pre></td>
<td class="coverage">1250x</td>
</tr>
<tr class="covered">
<td class="num">2020</td>
<td class="src"><pre><code class="objc">               !isOfTypeToBeRefreshed</code></pre></td>
<td class="coverage">904x</td>
</tr>
<tr class="covered">
<td class="num">2021</td>
<td class="src"><pre><code class="objc">            )</code></pre></td>
<td class="coverage">1600x</td>
</tr>
<tr class="covered">
<td class="num">2022</td>
<td class="src"><pre><code class="objc">            {</code></pre></td>
<td class="coverage">1480x</td>
</tr>
<tr class="covered">
<td class="num">2023</td>
<td class="src"><pre><code class="objc">                continue;</code></pre></td>
<td class="coverage">1480x</td>
</tr>
<tr class="covered">
<td class="num">2024</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">1480x</td>
</tr>
<tr class="covered">
<td class="num">2025</td>
<td class="src"><pre><code class="objc">            [managedObjectContext refreshObject:obj mergeChanges:obj.hasChanges];</code></pre></td>
<td class="coverage">126x</td>
</tr>
<tr class="covered">
<td class="num">2026</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">126x</td>
</tr>
<tr class="covered">
<td class="num">2027</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">1740x</td>
</tr>
<tr class="covered">
<td class="num">2028</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">342x</td>
</tr>
<tr class="never">
<td class="num">2029</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2030</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2031</td>
<td class="src"><pre><code class="objc">- (NSSet *)messagesNotToRefreshBecauseNeededForSorting</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">2032</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2033</td>
<td class="src"><pre><code class="objc">    NSMutableSet *messagesToKeep = [NSMutableSet set];</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2034</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2035</td>
<td class="src"><pre><code class="objc">    const static NSUInteger NumberOfMessagesToKeep = 3;</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2036</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2037</td>
<td class="src"><pre><code class="objc">    if(![self hasFaultForRelationshipNamed:ZMConversationMessagesKey])</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2038</td>
<td class="src"><pre><code class="objc">    {</code></pre></td>
<td class="coverage">241x</td>
</tr>
<tr class="covered">
<td class="num">2039</td>
<td class="src"><pre><code class="objc">        const NSUInteger length = self.messages.count;</code></pre></td>
<td class="coverage">241x</td>
</tr>
<tr class="covered">
<td class="num">2040</td>
<td class="src"><pre><code class="objc">        if(length == 0) {</code></pre></td>
<td class="coverage">241x</td>
</tr>
<tr class="covered">
<td class="num">2041</td>
<td class="src"><pre><code class="objc">            return [NSSet set];</code></pre></td>
<td class="coverage">148x</td>
</tr>
<tr class="covered">
<td class="num">2042</td>
<td class="src"><pre><code class="objc">        }</code></pre></td>
<td class="coverage">148x</td>
</tr>
<tr class="covered">
<td class="num">2043</td>
<td class="src"><pre><code class="objc">        NSUInteger currentIndex = length-1;</code></pre></td>
<td class="coverage">93x</td>
</tr>
<tr class="covered">
<td class="num">2044</td>
<td class="src"><pre><code class="objc">        const NSUInteger keepUntilIndex = (length-1 &gt;= NumberOfMessagesToKeep) // avoid overflow</code></pre></td>
<td class="coverage">93x</td>
</tr>
<tr class="covered">
<td class="num">2045</td>
<td class="src"><pre><code class="objc">        ? (length-1 - NumberOfMessagesToKeep)</code></pre></td>
<td class="coverage">7x</td>
</tr>
<tr class="covered">
<td class="num">2046</td>
<td class="src"><pre><code class="objc">        : length-1;</code></pre></td>
<td class="coverage">86x</td>
</tr>
<tr class="covered">
<td class="num">2047</td>
<td class="src"><pre><code class="objc">        </code></pre></td>
<td class="coverage">93x</td>
</tr>
<tr class="covered">
<td class="num">2048</td>
<td class="src"><pre><code class="objc">        while(YES) { // not using a for loop because when hitting 0, --i would make it overflow and wrap</code></pre></td>
<td class="coverage">114x</td>
</tr>
<tr class="covered">
<td class="num">2049</td>
<td class="src"><pre><code class="objc">            [messagesToKeep addObject:self.messages[currentIndex]];</code></pre></td>
<td class="coverage">114x</td>
</tr>
<tr class="covered">
<td class="num">2050</td>
<td class="src"><pre><code class="objc">            if(currentIndex == keepUntilIndex) {</code></pre></td>
<td class="coverage">114x</td>
</tr>
<tr class="covered">
<td class="num">2051</td>
<td class="src"><pre><code class="objc">                break;</code></pre></td>
<td class="coverage">93x</td>
</tr>
<tr class="covered">
<td class="num">2052</td>
<td class="src"><pre><code class="objc">            }</code></pre></td>
<td class="coverage">93x</td>
</tr>
<tr class="covered">
<td class="num">2053</td>
<td class="src"><pre><code class="objc">            --currentIndex;</code></pre></td>
<td class="coverage">21x</td>
</tr>
<tr class="covered">
<td class="num">2054</td>
<td class="src"><pre><code class="objc">        };</code></pre></td>
<td class="coverage">21x</td>
</tr>
<tr class="covered">
<td class="num">2055</td>
<td class="src"><pre><code class="objc">    }</code></pre></td>
<td class="coverage">93x</td>
</tr>
<tr class="covered">
<td class="num">2056</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2057</td>
<td class="src"><pre><code class="objc">    return messagesToKeep;</code></pre></td>
<td class="coverage">103x</td>
</tr>
<tr class="covered">
<td class="num">2058</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="never">
<td class="num">2059</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2060</td>
<td class="src"><pre><code class="objc">- (BOOL)shouldNotBeRefreshed</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">2061</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2062</td>
<td class="src"><pre><code class="objc">    static const int HOUR_IN_SEC = 60 * 60;</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2063</td>
<td class="src"><pre><code class="objc">    static const NSTimeInterval STALENESS = -36 * HOUR_IN_SEC;</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2064</td>
<td class="src"><pre><code class="objc">    return (self.isFault) || (self.lastModifiedDate == nil) || (self.lastModifiedDate.timeIntervalSinceNow &gt; STALENESS);</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="covered">
<td class="num">2065</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">251x</td>
</tr>
<tr class="never">
<td class="num">2066</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2067</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2068</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2069</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2070</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2071</td>
<td class="src"><pre><code class="objc">@implementation ZMConversation (History)</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2072</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2073</td>
<td class="src"><pre><code class="objc">- (BOOL)hasClearedMessageHistory</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">2074</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">2075</td>
<td class="src"><pre><code class="objc">    return self.clearedEventID != nil;</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">2076</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">2077</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2078</td>
<td class="src"><pre><code class="objc">- (BOOL)hasDownloadedMessageHistory</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="missed">
<td class="num">2079</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">2080</td>
<td class="src"><pre><code class="objc">    return self.lastEventIDGap == nil &amp;&amp; (self.lastEventID != nil || self.lastServerTimeStamp != nil);</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="missed">
<td class="num">2081</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">!</td>
</tr>
<tr class="never">
<td class="num">2082</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2083</td>
<td class="src"><pre><code class="objc">- (void)clearMessageHistory</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">2084</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">2085</td>
<td class="src"><pre><code class="objc">    self.isArchived = YES;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">2086</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">2087</td>
<td class="src"><pre><code class="objc">    self.lastReadEventID = self.lastEventID;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">2088</td>
<td class="src"><pre><code class="objc">    self.clearedEventID = self.lastEventID;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">2089</td>
<td class="src"><pre><code class="objc">    </code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">2090</td>
<td class="src"><pre><code class="objc">    self.clearedTimeStamp = self.lastServerTimeStamp; // the setter of this deletes all messages</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">2091</td>
<td class="src"><pre><code class="objc">    self.lastReadServerTimeStamp = self.lastServerTimeStamp;</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="covered">
<td class="num">2092</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">26x</td>
</tr>
<tr class="never">
<td class="num">2093</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2094</td>
<td class="src"><pre><code class="objc">- (void)revealClearedConversation</code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="covered">
<td class="num">2095</td>
<td class="src"><pre><code class="objc">{</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">2096</td>
<td class="src"><pre><code class="objc">    self.isArchived = NO;</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="covered">
<td class="num">2097</td>
<td class="src"><pre><code class="objc">}</code></pre></td>
<td class="coverage">1x</td>
</tr>
<tr class="never">
<td class="num">2098</td>
<td class="src"><pre><code class="objc"></code></pre></td>
<td class="coverage"></td>
</tr>
<tr class="never">
<td class="num">2099</td>
<td class="src"><pre><code class="objc">@end</code></pre></td>
<td class="coverage"></td>
</tr>
</table>
</div></div>
<footer><div class="row">
<p><a href="https://github.com/SlatherOrg/slather">Fork me on Github</a></p>
<p>&copy; 2016 Slather</p>
</div></footer><script src="highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
